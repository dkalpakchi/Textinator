{% set id=task|replace("_"," "|camelcase) %}
<div class="explorer-chart-container">
  <canvas id="{{ id }}Chart"></canvas>
</div>

<script>
  const ctx_{{id}} = document.getElementById('{{ id }}Chart');

  let {{id}}Chart = new Chart(ctx_{{id}}, {
    type: 'bar',
    data: {},
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        y: {
          beginAtZero: true,
          title: {
            display: true,
            text: '{{ y_text }}'
          }
        }
      },
      plugins: {
        title: {
          display: true,
          text: '{{ title }}'
        }
      }
    }
  });

  $.get(
    "{{ url('projects:chart_start', kwargs={'pk': project.pk}) }}",
    {'task': "{{ task }}"},
    function(data) {
      if (data.token) {
        let interval = setInterval(function () {
          $.get(
            "{{ url('projects:chart_status', kwargs={'pk': project.pk}) }}",
            data,
            function(res) {
              if (res.ready) {
                clearInterval(interval);
                if (!res.error) {
                  {{id}}Chart.data = res.data;
                  {{id}}Chart.update()
                }
              }
            }
          )
        }, 3000);
      }
    }
  )

</script>
