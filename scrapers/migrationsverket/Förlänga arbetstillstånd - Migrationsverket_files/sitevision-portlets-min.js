(function(){function d(t){return function(c,G,g,e){G=A(G,e,4);var b=!B(c)&&a.keys(c),d=(b||c).length,h=0<t?0:d-1;3>arguments.length&&(g=c[b?b[h]:h],h+=t);for(var f=G,k=g;0<=h&&h<d;h+=t)var r=b?b[h]:h,k=f(k,c[r],r,c);return k}}function m(a){return function(c,g,e){g=x(g,e);e=E(c);for(var b=0<a?0:e-1;0<=b&&b<e;b+=a)if(g(c[b],b,c))return b;return-1}}function n(t,c,g){return function(e,b,h){var d=0,f=E(e);if("number"==typeof h)0<t?d=0<=h?h:Math.max(h+f,d):f=0<=h?Math.min(h+1,f):h+f+1;else if(g&&h&&f)return h=
g(e,b),e[h]===b?h:-1;if(b!==b)return h=c(u.call(e,d,f),a.isNaN),0<=h?h+d:-1;for(h=0<t?d:f-1;0<=h&&h<f;h+=t)if(e[h]===b)return h;return-1}}function q(t,c){var g=L.length,h=t.constructor,h=a.isFunction(h)&&h.prototype||e,b="constructor";for(a.has(t,b)&&!a.contains(c,b)&&c.push(b);g--;)b=L[g],b in t&&t[b]!==h[b]&&!a.contains(c,b)&&c.push(b)}var b=this,l=b._,f=Array.prototype,e=Object.prototype,p=f.push,u=f.slice,k=e.toString,s=e.hasOwnProperty,r=Array.isArray,w=Object.keys,y=Function.prototype.bind,
z=Object.create,v=function(){},a=function(t){if(t instanceof a)return t;if(!(this instanceof a))return new a(t);this._wrapped=t};"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(exports=module.exports=a),exports._=a):b._=a;a.VERSION="1.8.3";var A=function(a,c,g){if(void 0===c)return a;switch(null==g?3:g){case 1:return function(g){return a.call(c,g)};case 2:return function(g,G){return a.call(c,g,G)};case 3:return function(g,G,h){return a.call(c,g,G,h)};case 4:return function(g,
G,h,b){return a.call(c,g,G,h,b)}}return function(){return a.apply(c,arguments)}},x=function(t,c,g){return null==t?a.identity:a.isFunction(t)?A(t,c,g):a.isObject(t)?a.matcher(t):a.property(t)};a.iteratee=function(a,c){return x(a,c,Infinity)};var D=function(a,c){return function(g){var h=arguments.length;if(2>h||null==g)return g;for(var b=1;b<h;b++)for(var e=arguments[b],d=a(e),f=d.length,k=0;k<f;k++){var r=d[k];c&&void 0!==g[r]||(g[r]=e[r])}return g}},F=function(t){if(!a.isObject(t))return{};if(z)return z(t);
v.prototype=t;t=new v;v.prototype=null;return t},H=function(a){return function(c){return null==c?void 0:c[a]}},J=Math.pow(2,53)-1,E=H("length"),B=function(a){a=E(a);return"number"==typeof a&&0<=a&&a<=J};a.each=a.forEach=function(t,c,g){c=A(c,g);var h;if(B(t))for(g=0,h=t.length;g<h;g++)c(t[g],g,t);else{var b=a.keys(t);g=0;for(h=b.length;g<h;g++)c(t[b[g]],b[g],t)}return t};a.map=a.collect=function(t,c,g){c=x(c,g);g=!B(t)&&a.keys(t);for(var h=(g||t).length,b=Array(h),e=0;e<h;e++){var d=g?g[e]:e;b[e]=
c(t[d],d,t)}return b};a.reduce=a.foldl=a.inject=d(1);a.reduceRight=a.foldr=d(-1);a.find=a.detect=function(t,c,g){c=B(t)?a.findIndex(t,c,g):a.findKey(t,c,g);if(void 0!==c&&-1!==c)return t[c]};a.filter=a.select=function(t,c,g){var h=[];c=x(c,g);a.each(t,function(a,t,g){c(a,t,g)&&h.push(a)});return h};a.reject=function(t,c,g){return a.filter(t,a.negate(x(c)),g)};a.every=a.all=function(t,c,g){c=x(c,g);g=!B(t)&&a.keys(t);for(var h=(g||t).length,b=0;b<h;b++){var e=g?g[b]:b;if(!c(t[e],e,t))return!1}return!0};
a.some=a.any=function(t,c,g){c=x(c,g);g=!B(t)&&a.keys(t);for(var h=(g||t).length,b=0;b<h;b++){var e=g?g[b]:b;if(c(t[e],e,t))return!0}return!1};a.contains=a.includes=a.include=function(t,c,g,h){B(t)||(t=a.values(t));if("number"!=typeof g||h)g=0;return 0<=a.indexOf(t,c,g)};a.invoke=function(t,c){var g=u.call(arguments,2),h=a.isFunction(c);return a.map(t,function(a){var t=h?c:a[c];return null==t?t:t.apply(a,g)})};a.pluck=function(t,c){return a.map(t,a.property(c))};a.where=function(c,g){return a.filter(c,
a.matcher(g))};a.findWhere=function(c,g){return a.find(c,a.matcher(g))};a.max=function(c,g,h){var b=-Infinity,e=-Infinity,d;if(null==g&&null!=c){c=B(c)?c:a.values(c);for(var f=0,k=c.length;f<k;f++)h=c[f],h>b&&(b=h)}else g=x(g,h),a.each(c,function(a,c,t){d=g(a,c,t);if(d>e||-Infinity===d&&-Infinity===b)b=a,e=d});return b};a.min=function(c,g,h){var b=Infinity,e=Infinity,d;if(null==g&&null!=c){c=B(c)?c:a.values(c);for(var f=0,k=c.length;f<k;f++)h=c[f],h<b&&(b=h)}else g=x(g,h),a.each(c,function(a,c,t){d=
g(a,c,t);if(d<e||Infinity===d&&Infinity===b)b=a,e=d});return b};a.shuffle=function(c){c=B(c)?c:a.values(c);for(var g=c.length,h=Array(g),b=0,e;b<g;b++)e=a.random(0,b),e!==b&&(h[b]=h[e]),h[e]=c[b];return h};a.sample=function(c,g,h){return null==g||h?(B(c)||(c=a.values(c)),c[a.random(c.length-1)]):a.shuffle(c).slice(0,Math.max(0,g))};a.sortBy=function(c,g,h){g=x(g,h);return a.pluck(a.map(c,function(a,c,t){return{value:a,index:c,criteria:g(a,c,t)}}).sort(function(a,c){var t=a.criteria,g=c.criteria;if(t!==
g){if(t>g||void 0===t)return 1;if(t<g||void 0===g)return-1}return a.index-c.index}),"value")};var K=function(c){return function(g,h,b){var e={};h=x(h,b);a.each(g,function(a,b){var d=h(a,b,g);c(e,a,d)});return e}};a.groupBy=K(function(c,g,h){a.has(c,h)?c[h].push(g):c[h]=[g]});a.indexBy=K(function(a,c,g){a[g]=c});a.countBy=K(function(c,g,h){a.has(c,h)?c[h]++:c[h]=1});a.toArray=function(c){return c?a.isArray(c)?u.call(c):B(c)?a.map(c,a.identity):a.values(c):[]};a.size=function(c){return null==c?0:B(c)?
c.length:a.keys(c).length};a.partition=function(c,g,h){g=x(g,h);var b=[],e=[];a.each(c,function(a,c,t){(g(a,c,t)?b:e).push(a)});return[b,e]};a.first=a.head=a.take=function(c,g,h){return null==c?void 0:null==g||h?c[0]:a.initial(c,c.length-g)};a.initial=function(a,c,g){return u.call(a,0,Math.max(0,a.length-(null==c||g?1:c)))};a.last=function(c,g,h){return null==c?void 0:null==g||h?c[c.length-1]:a.rest(c,Math.max(0,c.length-g))};a.rest=a.tail=a.drop=function(c,a,g){return u.call(c,null==a||g?1:a)};a.compact=
function(c){return a.filter(c,a.identity)};var I=function(c,g,h,b){var e=[],d=0;b=b||0;for(var f=E(c);b<f;b++){var k=c[b];if(B(k)&&(a.isArray(k)||a.isArguments(k))){g||(k=I(k,g,h));var r=0,s=k.length;for(e.length+=s;r<s;)e[d++]=k[r++]}else h||(e[d++]=k)}return e};a.flatten=function(c,a){return I(c,a,!1)};a.without=function(c){return a.difference(c,u.call(arguments,1))};a.uniq=a.unique=function(c,g,h,b){a.isBoolean(g)||(b=h,h=g,g=!1);null!=h&&(h=x(h,b));b=[];for(var e=[],d=0,f=E(c);d<f;d++){var k=
c[d],r=h?h(k,d,c):k;g?(d&&e===r||b.push(k),e=r):h?a.contains(e,r)||(e.push(r),b.push(k)):a.contains(b,k)||b.push(k)}return b};a.union=function(){return a.uniq(I(arguments,!0,!0))};a.intersection=function(c){for(var g=[],h=arguments.length,b=0,e=E(c);b<e;b++){var d=c[b];if(!a.contains(g,d)){for(var f=1;f<h&&a.contains(arguments[f],d);f++);f===h&&g.push(d)}}return g};a.difference=function(c){var g=I(arguments,!0,!0,1);return a.filter(c,function(c){return!a.contains(g,c)})};a.zip=function(){return a.unzip(arguments)};
a.unzip=function(c){for(var g=c&&a.max(c,E).length||0,h=Array(g),b=0;b<g;b++)h[b]=a.pluck(c,b);return h};a.object=function(c,a){for(var g={},h=0,b=E(c);h<b;h++)a?g[c[h]]=a[h]:g[c[h][0]]=c[h][1];return g};a.findIndex=m(1);a.findLastIndex=m(-1);a.sortedIndex=function(c,a,g,h){g=x(g,h,1);a=g(a);h=0;for(var b=E(c);h<b;){var e=Math.floor((h+b)/2);g(c[e])<a?h=e+1:b=e}return h};a.indexOf=n(1,a.findIndex,a.sortedIndex);a.lastIndexOf=n(-1,a.findLastIndex);a.range=function(c,a,g){null==a&&(a=c||0,c=0);g=g||
1;a=Math.max(Math.ceil((a-c)/g),0);for(var h=Array(a),b=0;b<a;b++,c+=g)h[b]=c;return h};var M=function(c,g,h,b,e){if(!(b instanceof g))return c.apply(h,e);g=F(c.prototype);c=c.apply(g,e);return a.isObject(c)?c:g};a.bind=function(c,g){if(y&&c.bind===y)return y.apply(c,u.call(arguments,1));if(!a.isFunction(c))throw new TypeError("Bind must be called on a function");var h=u.call(arguments,2),b=function(){return M(c,b,g,this,h.concat(u.call(arguments)))};return b};a.partial=function(c){var g=u.call(arguments,
1),h=function(){for(var b=0,e=g.length,d=Array(e),f=0;f<e;f++)d[f]=g[f]===a?arguments[b++]:g[f];for(;b<arguments.length;)d.push(arguments[b++]);return M(c,h,this,this,d)};return h};a.bindAll=function(c){var g,h=arguments.length,b;if(1>=h)throw Error("bindAll must be passed function names");for(g=1;g<h;g++)b=arguments[g],c[b]=a.bind(c[b],c);return c};a.memoize=function(c,g){var h=function(b){var e=h.cache,d=""+(g?g.apply(this,arguments):b);a.has(e,d)||(e[d]=c.apply(this,arguments));return e[d]};h.cache=
{};return h};a.delay=function(c,a){var g=u.call(arguments,2);return setTimeout(function(){return c.apply(null,g)},a)};a.defer=a.partial(a.delay,a,1);a.throttle=function(c,g,h){var b,e,d,f=null,k=0;h||(h={});var r=function(){k=!1===h.leading?0:a.now();f=null;d=c.apply(b,e);f||(b=e=null)};return function(){var s=a.now();k||!1!==h.leading||(k=s);var p=g-(s-k);b=this;e=arguments;0>=p||p>g?(f&&(clearTimeout(f),f=null),k=s,d=c.apply(b,e),f||(b=e=null)):f||!1===h.trailing||(f=setTimeout(r,p));return d}};
a.debounce=function(c,g,h){var b,e,d,f,k,r=function(){var s=a.now()-f;s<g&&0<=s?b=setTimeout(r,g-s):(b=null,h||(k=c.apply(d,e),b||(d=e=null)))};return function(){d=this;e=arguments;f=a.now();var s=h&&!b;b||(b=setTimeout(r,g));s&&(k=c.apply(d,e),d=e=null);return k}};a.wrap=function(c,g){return a.partial(g,c)};a.negate=function(c){return function(){return!c.apply(this,arguments)}};a.compose=function(){var c=arguments,a=c.length-1;return function(){for(var g=a,h=c[a].apply(this,arguments);g--;)h=c[g].call(this,
h);return h}};a.after=function(c,a){return function(){if(1>--c)return a.apply(this,arguments)}};a.before=function(c,a){var g;return function(){0<--c&&(g=a.apply(this,arguments));1>=c&&(a=null);return g}};a.once=a.partial(a.before,2);var N=!{toString:null}.propertyIsEnumerable("toString"),L="valueOf isPrototypeOf toString propertyIsEnumerable hasOwnProperty toLocaleString".split(" ");a.keys=function(c){if(!a.isObject(c))return[];if(w)return w(c);var g=[],h;for(h in c)a.has(c,h)&&g.push(h);N&&q(c,g);
return g};a.allKeys=function(c){if(!a.isObject(c))return[];var g=[],h;for(h in c)g.push(h);N&&q(c,g);return g};a.values=function(c){for(var g=a.keys(c),h=g.length,b=Array(h),e=0;e<h;e++)b[e]=c[g[e]];return b};a.mapObject=function(c,g,h){g=x(g,h);h=a.keys(c);for(var b=h.length,e={},d,f=0;f<b;f++)d=h[f],e[d]=g(c[d],d,c);return e};a.pairs=function(c){for(var g=a.keys(c),h=g.length,b=Array(h),e=0;e<h;e++)b[e]=[g[e],c[g[e]]];return b};a.invert=function(c){for(var g={},h=a.keys(c),b=0,e=h.length;b<e;b++)g[c[h[b]]]=
h[b];return g};a.functions=a.methods=function(c){var g=[],h;for(h in c)a.isFunction(c[h])&&g.push(h);return g.sort()};a.extend=D(a.allKeys);a.extendOwn=a.assign=D(a.keys);a.findKey=function(c,g,h){g=x(g,h);h=a.keys(c);for(var b,e=0,d=h.length;e<d;e++)if(b=h[e],g(c[b],b,c))return b};a.pick=function(c,g,h){var b={},e=c,d,f;if(null==e)return b;a.isFunction(g)?(f=a.allKeys(e),d=A(g,h)):(f=I(arguments,!1,!1,1),d=function(c,a,g){return a in g},e=Object(e));for(var k=0,r=f.length;k<r;k++){var s=f[k],p=e[s];
d(p,s,e)&&(b[s]=p)}return b};a.omit=function(c,g,h){if(a.isFunction(g))g=a.negate(g);else{var b=a.map(I(arguments,!1,!1,1),String);g=function(c,g){return!a.contains(b,g)}}return a.pick(c,g,h)};a.defaults=D(a.allKeys,!0);a.create=function(c,g){var h=F(c);g&&a.extendOwn(h,g);return h};a.clone=function(c){return a.isObject(c)?a.isArray(c)?c.slice():a.extend({},c):c};a.tap=function(c,a){a(c);return c};a.isMatch=function(c,g){var h=a.keys(g),b=h.length;if(null==c)return!b;for(var e=Object(c),d=0;d<b;d++){var f=
h[d];if(g[f]!==e[f]||!(f in e))return!1}return!0};var C=function(c,g,h,b){if(c===g)return 0!==c||1/c===1/g;if(null==c||null==g)return c===g;c instanceof a&&(c=c._wrapped);g instanceof a&&(g=g._wrapped);var e=k.call(c);if(e!==k.call(g))return!1;switch(e){case "[object RegExp]":case "[object String]":return""+c===""+g;case "[object Number]":return+c!==+c?+g!==+g:0===+c?1/+c===1/g:+c===+g;case "[object Date]":case "[object Boolean]":return+c===+g}e="[object Array]"===e;if(!e){if("object"!=typeof c||
"object"!=typeof g)return!1;var d=c.constructor,f=g.constructor;if(d!==f&&!(a.isFunction(d)&&d instanceof d&&a.isFunction(f)&&f instanceof f)&&"constructor"in c&&"constructor"in g)return!1}h=h||[];b=b||[];for(d=h.length;d--;)if(h[d]===c)return b[d]===g;h.push(c);b.push(g);if(e){d=c.length;if(d!==g.length)return!1;for(;d--;)if(!C(c[d],g[d],h,b))return!1}else{e=a.keys(c);d=e.length;if(a.keys(g).length!==d)return!1;for(;d--;)if(f=e[d],!a.has(g,f)||!C(c[f],g[f],h,b))return!1}h.pop();b.pop();return!0};
a.isEqual=function(c,a){return C(c,a)};a.isEmpty=function(c){return null==c?!0:B(c)&&(a.isArray(c)||a.isString(c)||a.isArguments(c))?0===c.length:0===a.keys(c).length};a.isElement=function(c){return!(!c||1!==c.nodeType)};a.isArray=r||function(c){return"[object Array]"===k.call(c)};a.isObject=function(c){var a=typeof c;return"function"===a||"object"===a&&!!c};a.each("Arguments Function String Number Date RegExp Error".split(" "),function(c){a["is"+c]=function(a){return k.call(a)==="[object "+c+"]"}});
a.isArguments(arguments)||(a.isArguments=function(c){return a.has(c,"callee")});"function"!=typeof/./&&"object"!=typeof Int8Array&&(a.isFunction=function(c){return"function"==typeof c||!1});a.isFinite=function(c){return isFinite(c)&&!isNaN(parseFloat(c))};a.isNaN=function(c){return a.isNumber(c)&&c!==+c};a.isBoolean=function(c){return!0===c||!1===c||"[object Boolean]"===k.call(c)};a.isNull=function(c){return null===c};a.isUndefined=function(c){return void 0===c};a.has=function(c,a){return null!=c&&
s.call(c,a)};a.noConflict=function(){b._=l;return this};a.identity=function(c){return c};a.constant=function(c){return function(){return c}};a.noop=function(){};a.property=H;a.propertyOf=function(c){return null==c?function(){}:function(a){return c[a]}};a.matcher=a.matches=function(c){c=a.extendOwn({},c);return function(g){return a.isMatch(g,c)}};a.times=function(c,a,g){var h=Array(Math.max(0,c));a=A(a,g,1);for(g=0;g<c;g++)h[g]=a(g);return h};a.random=function(c,a){null==a&&(a=c,c=0);return c+Math.floor(Math.random()*
(a-c+1))};a.now=Date.now||function(){return(new Date).getTime()};r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};D=a.invert(r);H=function(c){var g=function(a){return c[a]},h="(?:"+a.keys(c).join("|")+")",b=RegExp(h),e=RegExp(h,"g");return function(c){c=null==c?"":""+c;return b.test(c)?c.replace(e,g):c}};a.escape=H(r);a.unescape=H(D);a.result=function(c,g,h){g=null==c?void 0:c[g];void 0===g&&(g=h);return a.isFunction(g)?g.call(c):g};var c=0;a.uniqueId=function(a){var g=
++c+"";return a?a+g:g};a.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var g=/(.)^/,h={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},P=/\\|'|\r|\n|\u2028|\u2029/g,Q=function(c){return"\\"+h[c]};a.template=function(c,h,b){!h&&b&&(h=b);h=a.defaults({},h,a.templateSettings);b=RegExp([(h.escape||g).source,(h.interpolate||g).source,(h.evaluate||g).source].join("|")+"|$","g");var e=0,d="__p+='";c.replace(b,function(a,g,h,
b,f){d+=c.slice(e,f).replace(P,Q);e=f+a.length;g?d+="'+\n((__t=("+g+"))==null?'':_.escape(__t))+\n'":h?d+="'+\n((__t=("+h+"))==null?'':__t)+\n'":b&&(d+="';\n"+b+"\n__p+='");return a});d+="';\n";h.variable||(d="with(obj||{}){\n"+d+"}\n");d="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+d+"return __p;\n";try{var f=new Function(h.variable||"obj","_",d)}catch(k){throw k.source=d,k;}b=function(c){return f.call(this,c,a)};b.source="function("+(h.variable||"obj")+
"){\n"+d+"}";return b};a.chain=function(c){c=a(c);c._chain=!0;return c};var O=function(c,g){return c._chain?a(g).chain():g};a.mixin=function(c){a.each(a.functions(c),function(g){var h=a[g]=c[g];a.prototype[g]=function(){var c=[this._wrapped];p.apply(c,arguments);return O(this,h.apply(a,c))}})};a.mixin(a);a.each("pop push reverse shift sort splice unshift".split(" "),function(c){var g=f[c];a.prototype[c]=function(){var a=this._wrapped;g.apply(a,arguments);"shift"!==c&&"splice"!==c||0!==a.length||delete a[0];
return O(this,a)}});a.each(["concat","join","slice"],function(c){var g=f[c];a.prototype[c]=function(){return O(this,g.apply(this._wrapped,arguments))}});a.prototype.value=function(){return this._wrapped};a.prototype.valueOf=a.prototype.toJSON=a.prototype.value;a.prototype.toString=function(){return""+this._wrapped};"function"===typeof define&&define.amd&&define("underscore",[],function(){return a})}).call(this);window._sv=_.noConflict();
(function(){var d=this,m=d.Backbone,n=[],q=n.push,b=n.slice,l=n.splice,f;f="undefined"!==typeof exports?exports:d.Backbone={};f.VERSION="1.0.0";var e=d._sv;e||"undefined"===typeof require||(e=require("underscore"));f.$=d.jQuery||d.Zepto||d.ender||d.$;f.noConflict=function(){d.Backbone=m;return this};f.emulateHTTP=!1;f.emulateJSON=!1;var p=f.Events={on:function(c,a,h){if(!k(this,"on",c,[a,h])||!a)return this;this._events||(this._events={});(this._events[c]||(this._events[c]=[])).push({callback:a,context:h,
ctx:h||this});return this},once:function(c,a,h){if(!k(this,"once",c,[a,h])||!a)return this;var b=this,d=e.once(function(){b.off(c,d);a.apply(this,arguments)});d._callback=a;return this.on(c,d,h)},off:function(c,a,h){var b,d,f,r,s,p,l,m;if(!this._events||!k(this,"off",c,[a,h]))return this;if(!c&&!a&&!h)return this._events={},this;r=c?[c]:e.keys(this._events);s=0;for(p=r.length;s<p;s++)if(c=r[s],f=this._events[c]){this._events[c]=b=[];if(a||h)for(l=0,m=f.length;l<m;l++)d=f[l],(a&&a!==d.callback&&a!==
d.callback._callback||h&&h!==d.context)&&b.push(d);b.length||delete this._events[c]}return this},trigger:function(c){if(!this._events)return this;var a=b.call(arguments,1);if(!k(this,"trigger",c,a))return this;var h=this._events[c],e=this._events.all;h&&s(h,a);e&&s(e,arguments);return this},stopListening:function(c,a,h){var b=this._listeners;if(!b)return this;var e=!a&&!h;"object"===typeof a&&(h=this);c&&((b={})[c._listenerId]=c);for(var d in b)b[d].off(a,h,this),e&&delete this._listeners[d];return this}},
u=/\s+/,k=function(c,a,h,b){if(!h)return!0;if("object"===typeof h){for(var e in h)c[a].apply(c,[e,h[e]].concat(b));return!1}if(u.test(h)){h=h.split(u);e=0;for(var d=h.length;e<d;e++)c[a].apply(c,[h[e]].concat(b));return!1}return!0},s=function(c,a){var h,b=-1,e=c.length,d=a[0],f=a[1],k=a[2];switch(a.length){case 0:for(;++b<e;)(h=c[b]).callback.call(h.ctx);break;case 1:for(;++b<e;)(h=c[b]).callback.call(h.ctx,d);break;case 2:for(;++b<e;)(h=c[b]).callback.call(h.ctx,d,f);break;case 3:for(;++b<e;)(h=
c[b]).callback.call(h.ctx,d,f,k);break;default:for(;++b<e;)(h=c[b]).callback.apply(h.ctx,a)}};e.each({listenTo:"on",listenToOnce:"once"},function(c,a){p[a]=function(a,g,b){var d=this._listeners||(this._listeners={}),f=a._listenerId||(a._listenerId=e.uniqueId("l"));d[f]=a;"object"===typeof g&&(b=this);a[c](g,b,this);return this}});p.bind=p.on;p.unbind=p.off;e.extend(f,p);var r=f.Model=function(c,a){var h,b=c||{};a||(a={});this.cid=e.uniqueId("c");this.attributes={};e.extend(this,e.pick(a,w));a.parse&&
(b=this.parse(b,a)||{});if(h=e.result(this,"defaults"))b=e.defaults({},b,h);this.set(b,a);this.changed={};this.initialize.apply(this,arguments)},w=["url","urlRoot","collection"];e.extend(r.prototype,p,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(c){return e.clone(this.attributes)},sync:function(){return f.sync.apply(this,arguments)},get:function(c){return this.attributes[c]},escape:function(c){return e.escape(this.get(c))},has:function(c){return null!=
this.get(c)},set:function(c,a,h){var b,d,f,k,r,s,p;if(null==c)return this;"object"===typeof c?(d=c,h=a):(d={})[c]=a;h||(h={});if(!this._validate(d,h))return!1;f=h.unset;k=h.silent;c=[];r=this._changing;this._changing=!0;r||(this._previousAttributes=e.clone(this.attributes),this.changed={});p=this.attributes;s=this._previousAttributes;this.idAttribute in d&&(this.id=d[this.idAttribute]);for(b in d)a=d[b],e.isEqual(p[b],a)||c.push(b),e.isEqual(s[b],a)?delete this.changed[b]:this.changed[b]=a,f?delete p[b]:
p[b]=a;if(!k)for(c.length&&(this._pending=!0),a=0,b=c.length;a<b;a++)this.trigger("change:"+c[a],this,p[c[a]],h);if(r)return this;if(!k)for(;this._pending;)this._pending=!1,this.trigger("change",this,h);this._changing=this._pending=!1;return this},unset:function(c,a){return this.set(c,void 0,e.extend({},a,{unset:!0}))},clear:function(c){var a={},b;for(b in this.attributes)a[b]=void 0;return this.set(a,e.extend({},c,{unset:!0}))},hasChanged:function(c){return null==c?!e.isEmpty(this.changed):e.has(this.changed,
c)},changedAttributes:function(c){if(!c)return this.hasChanged()?e.clone(this.changed):!1;var a,b=!1,d=this._changing?this._previousAttributes:this.attributes,f;for(f in c)e.isEqual(d[f],a=c[f])||((b||(b={}))[f]=a);return b},previous:function(c){return null!=c&&this._previousAttributes?this._previousAttributes[c]:null},previousAttributes:function(){return e.clone(this._previousAttributes)},fetch:function(c){c=c?e.clone(c):{};void 0===c.parse&&(c.parse=!0);var a=this,b=c.success;c.success=function(e){if(!a.set(a.parse(e,
c),c))return!1;b&&b(a,e,c);a.trigger("sync",a,e,c)};C(this,c);return this.sync("read",this,c)},save:function(c,a,b){var d,f=this.attributes;null==c||"object"===typeof c?(d=c,b=a):(d={})[c]=a;if(!(!d||b&&b.wait||this.set(d,b)))return!1;b=e.extend({validate:!0},b);if(!this._validate(d,b))return!1;d&&b.wait&&(this.attributes=e.extend({},f,d));void 0===b.parse&&(b.parse=!0);var k=this,r=b.success;b.success=function(c){k.attributes=f;var a=k.parse(c,b);b.wait&&(a=e.extend(d||{},a));if(e.isObject(a)&&!k.set(a,
b))return!1;r&&r(k,c,b);k.trigger("sync",k,c,b)};C(this,b);c=this.isNew()?"create":b.patch?"patch":"update";"patch"===c&&(b.attrs=d);c=this.sync(c,this,b);d&&b.wait&&(this.attributes=f);return c},destroy:function(c){c=c?e.clone(c):{};var a=this,b=c.success,d=function(){a.trigger("destroy",a,a.collection,c)};c.success=function(e){(c.wait||a.isNew())&&d();b&&b(a,e,c);a.isNew()||a.trigger("sync",a,e,c)};if(this.isNew())return c.success(),!1;C(this,c);var f=this.sync("delete",this,c);c.wait||d();return f},
url:function(){var c=e.result(this,"urlRoot")||e.result(this.collection,"url")||L();return this.isNew()?c:c+("/"===c.charAt(c.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(c,a){return c},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(c){return this._validate({},e.extend(c||{},{validate:!0}))},_validate:function(c,a){if(!a.validate||!this.validate)return!0;c=e.extend({},this.attributes,c);var b=this.validationError=
this.validate(c,a)||null;if(!b)return!0;this.trigger("invalid",this,b,e.extend(a||{},{validationError:b}));return!1}});e.each("keys values pairs invert pick omit".split(" "),function(c){r.prototype[c]=function(){var a=b.call(arguments);a.unshift(this.attributes);return e[c].apply(e,a)}});var y=f.Collection=function(c,a){a||(a={});a.url&&(this.url=a.url);a.model&&(this.model=a.model);void 0!==a.comparator&&(this.comparator=a.comparator);this._reset();this.initialize.apply(this,arguments);c&&this.reset(c,
e.extend({silent:!0},a))},z={add:!0,remove:!0,merge:!0},v={add:!0,merge:!1,remove:!1};e.extend(y.prototype,p,{model:r,initialize:function(){},toJSON:function(c){return this.map(function(a){return a.toJSON(c)})},sync:function(){return f.sync.apply(this,arguments)},add:function(c,a){return this.set(c,e.defaults(a||{},v))},remove:function(c,a){c=e.isArray(c)?c.slice():[c];a||(a={});var b,d,f,k;b=0;for(d=c.length;b<d;b++)if(k=this.get(c[b]))delete this._byId[k.id],delete this._byId[k.cid],f=this.indexOf(k),
this.models.splice(f,1),this.length--,a.silent||(a.index=f,k.trigger("remove",k,this,a)),this._removeReference(k);return this},set:function(c,a){a=e.defaults(a||{},z);a.parse&&(c=this.parse(c,a));e.isArray(c)||(c=c?[c]:[]);var b,d,f,k,r,s=a.at,p=this.comparator&&null==s&&!1!==a.sort,m=e.isString(this.comparator)?this.comparator:null,n=[],J=[],x={};b=0;for(d=c.length;b<d;b++)if(f=this._prepareModel(c[b],a))(k=this.get(f))?(a.remove&&(x[k.cid]=!0),a.merge&&(k.set(f.attributes,a),p&&!r&&k.hasChanged(m)&&
(r=!0))):a.add&&(n.push(f),f.on("all",this._onModelEvent,this),this._byId[f.cid]=f,null!=f.id&&(this._byId[f.id]=f));if(a.remove){b=0;for(d=this.length;b<d;++b)x[(f=this.models[b]).cid]||J.push(f);J.length&&this.remove(J,a)}n.length&&(p&&(r=!0),this.length+=n.length,null!=s?l.apply(this.models,[s,0].concat(n)):q.apply(this.models,n));r&&this.sort({silent:!0});if(a.silent)return this;b=0;for(d=n.length;b<d;b++)(f=n[b]).trigger("add",f,this,a);r&&this.trigger("sort",this,a);return this},reset:function(c,
a){a||(a={});for(var b=0,d=this.models.length;b<d;b++)this._removeReference(this.models[b]);a.previousModels=this.models;this._reset();this.add(c,e.extend({silent:!0},a));a.silent||this.trigger("reset",this,a);return this},push:function(c,a){c=this._prepareModel(c,a);this.add(c,e.extend({at:this.length},a));return c},pop:function(c){var a=this.at(this.length-1);this.remove(a,c);return a},unshift:function(c,a){c=this._prepareModel(c,a);this.add(c,e.extend({at:0},a));return c},shift:function(c){var a=
this.at(0);this.remove(a,c);return a},slice:function(c,a){return this.models.slice(c,a)},get:function(c){return null==c?void 0:this._byId[null!=c.id?c.id:c.cid||c]},at:function(c){return this.models[c]},where:function(c,a){return e.isEmpty(c)?a?void 0:[]:this[a?"find":"filter"](function(a){for(var b in c)if(c[b]!==a.get(b))return!1;return!0})},findWhere:function(c){return this.where(c,!0)},sort:function(c){if(!this.comparator)throw Error("Cannot sort a set without a comparator");c||(c={});e.isString(this.comparator)||
1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(e.bind(this.comparator,this));c.silent||this.trigger("sort",this,c);return this},sortedIndex:function(c,a,b){a||(a=this.comparator);var d=e.isFunction(a)?a:function(c){return c.get(a)};return e.sortedIndex(this.models,c,d,b)},pluck:function(c){return e.invoke(this.models,"get",c)},fetch:function(c){c=c?e.clone(c):{};void 0===c.parse&&(c.parse=!0);var a=c.success,b=this;c.success=function(d){b[c.reset?"reset":
"set"](d,c);a&&a(b,d,c);b.trigger("sync",b,d,c)};C(this,c);return this.sync("read",this,c)},create:function(c,a){a=a?e.clone(a):{};if(!(c=this._prepareModel(c,a)))return!1;a.wait||this.add(c,a);var b=this,d=a.success;a.success=function(e){a.wait&&b.add(c,a);d&&d(c,e,a)};c.save(null,a);return c},parse:function(c,a){return c},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(c,a){if(c instanceof r)return c.collection||
(c.collection=this),c;a||(a={});a.collection=this;var b=new this.model(c,a);return b._validate(c,a)?b:(this.trigger("invalid",this,c,a),!1)},_removeReference:function(c){this===c.collection&&delete c.collection;c.off("all",this._onModelEvent,this)},_onModelEvent:function(c,a,b,d){if("add"!==c&&"remove"!==c||b===this)"destroy"===c&&this.remove(a,d),a&&c==="change:"+a.idAttribute&&(delete this._byId[a.previous(a.idAttribute)],null!=a.id&&(this._byId[a.id]=a)),this.trigger.apply(this,arguments)}});e.each("forEach each map collect reduce foldl inject reduceRight foldr find detect filter select reject every all some any include contains invoke max min toArray size first head take initial rest tail drop last without indexOf shuffle lastIndexOf isEmpty chain".split(" "),
function(c){y.prototype[c]=function(){var a=b.call(arguments);a.unshift(this.models);return e[c].apply(e,a)}});e.each(["groupBy","countBy","sortBy"],function(c){y.prototype[c]=function(a,b){var d=e.isFunction(a)?a:function(c){return c.get(a)};return e[c](this.models,d,b)}});var n=f.View=function(c){this.cid=e.uniqueId("view");this._configure(c||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()},a=/^(\S+)\s*(.*)$/,A="model collection el id attributes className tagName events".split(" ");
e.extend(n.prototype,p,{tagName:"div",$:function(c){return this.$el.find(c)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(c,a){this.$el&&this.undelegateEvents();this.$el=c instanceof f.$?c:f.$(c);this.el=this.$el[0];!1!==a&&this.delegateEvents();return this},delegateEvents:function(c){if(!c&&!(c=e.result(this,"events")))return this;this.undelegateEvents();for(var b in c){var d=c[b];e.isFunction(d)||
(d=this[c[b]]);if(d){var f=b.match(a),k=f[1],f=f[2],d=e.bind(d,this),k=k+(".delegateEvents"+this.cid);if(""===f)this.$el.on(k,d);else this.$el.on(k,f,d)}}return this},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid);return this},_configure:function(c){this.options&&(c=e.extend({},e.result(this,"options"),c));e.extend(this,e.pick(c,A));this.options=c},_ensureElement:function(){if(this.el)this.setElement(e.result(this,"el"),!1);else{var c=e.extend({},e.result(this,"attributes"));
this.id&&(c.id=e.result(this,"id"));this.className&&(c["class"]=e.result(this,"className"));c=f.$("<"+e.result(this,"tagName")+">").attr(c);this.setElement(c,!1)}}});f.sync=function(c,a,b){var d=x[c];e.defaults(b||(b={}),{emulateHTTP:f.emulateHTTP,emulateJSON:f.emulateJSON});var k={type:d,dataType:"json"};b.url||(k.url=e.result(a,"url")||L());null!=b.data||!a||"create"!==c&&"update"!==c&&"patch"!==c||(k.contentType="application/json",k.data=JSON.stringify(b.attrs||a.toJSON(b)));b.emulateJSON&&(k.contentType=
"application/x-www-form-urlencoded",k.data=k.data?{model:k.data}:{});if(b.emulateHTTP&&("PUT"===d||"DELETE"===d||"PATCH"===d)){k.type="POST";b.emulateJSON&&(k.data._method=d);var r=b.beforeSend;b.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",d);if(r)return r.apply(this,arguments)}}"GET"===k.type||b.emulateJSON||(k.processData=!1);"PATCH"!==k.type||!window.ActiveXObject||window.external&&window.external.msActiveXFilteringEnabled||(k.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});
c=b.xhr=f.ajax(e.extend(k,b));a.trigger("request",a,c,b);return c};var x={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};f.ajax=function(){return f.$.ajax.apply(f.$,arguments)};var D=f.Router=function(a){a||(a={});a.routes&&(this.routes=a.routes);this._bindRoutes();this.initialize.apply(this,arguments)},F=/\((.*?)\)/g,H=/(\(\?)?:\w+/g,J=/\*\w+/g,E=/[\-{}\[\]+?.,\\\^$|#\s]/g;e.extend(D.prototype,p,{initialize:function(){},route:function(a,b,d){e.isRegExp(a)||(a=this._routeToRegExp(a));
e.isFunction(b)&&(d=b,b="");d||(d=this[b]);var k=this;f.history.route(a,function(e){e=k._extractParameters(a,e);d&&d.apply(k,e);k.trigger.apply(k,["route:"+b].concat(e));k.trigger("route",b,e);f.history.trigger("route",k,b,e)});return this},navigate:function(a,b){f.history.navigate(a,b);return this},_bindRoutes:function(){if(this.routes){this.routes=e.result(this,"routes");for(var a,b=e.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(a){a=a.replace(E,"\\$&").replace(F,
"(?:$1)?").replace(H,function(a,c){return c?a:"([^/]+)"}).replace(J,"(.*?)");return new RegExp("^"+a+"$")},_extractParameters:function(a,b){var d=a.exec(b).slice(1);return e.map(d,function(a){return a?decodeURIComponent(a):null})}});var B=f.History=function(){this.handlers=[];e.bindAll(this,"checkUrl");"undefined"!==typeof window&&(this.location=window.location,this.history=window.history)},K=/^[#\/]|\s+$/g,I=/^\/+|\/+$/g,M=/msie [\w.]+/,N=/\/$/;B.started=!1;e.extend(B.prototype,p,{interval:50,getHash:function(a){return(a=
(a||this).location.href.match(/#(.*)$/))?a[1]:""},getFragment:function(a,b){if(null==a)if(this._hasPushState||!this._wantsHashChange||b){a=this.location.pathname;var d=this.root.replace(N,"");a.indexOf(d)||(a=a.substr(d.length))}else a=this.getHash();return a.replace(K,"")},start:function(a){if(B.started)throw Error("Backbone.history has already been started");B.started=!0;this.options=e.extend({},{root:"/"},this.options,a);this.root=this.options.root;this._wantsHashChange=!1!==this.options.hashChange;
this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);a=this.getFragment();var b=document.documentMode,b=M.exec(navigator.userAgent.toLowerCase())&&(!b||7>=b);this.root=("/"+this.root+"/").replace(I,"/");b&&this._wantsHashChange&&(this.iframe=f.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(a));if(this._hasPushState)f.$(window).on("popstate",this.checkUrl);else if(this._wantsHashChange&&
"onhashchange"in window&&!b)f.$(window).on("hashchange",this.checkUrl);else this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval));this.fragment=a;a=this.location;b=a.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!b)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&b&&a.hash&&(this.fragment=
this.getHash().replace(K,""),this.history.replaceState({},document.title,this.root+this.fragment+a.search));if(!this.options.silent)return this.loadUrl()},stop:function(){f.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);B.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){a=this.getFragment();a===this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe)));if(a===this.fragment)return!1;
this.iframe&&this.navigate(a);this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(a){var b=this.fragment=this.getFragment(a);return e.any(this.handlers,function(a){if(a.route.test(b))return a.callback(b),!0})},navigate:function(a,b){if(!B.started)return!1;b&&!0!==b||(b={trigger:b});a=this.getFragment(a||"");if(this.fragment!==a){this.fragment=a;var d=this.root+a;if(this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,d);else if(this._wantsHashChange)this._updateHash(this.location,
a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace));else return this.location.assign(d);b.trigger&&this.loadUrl(a)}},_updateHash:function(a,b,d){d?(d=a.href.replace(/(javascript:|#).*$/,""),a.replace(d+"#"+b)):a.hash="#"+b}});f.history=new B;r.extend=y.extend=D.extend=n.extend=B.extend=function(a,b){var d=this,f;f=a&&e.has(a,"constructor")?a.constructor:function(){return d.apply(this,
arguments)};e.extend(f,d,b);var k=function(){this.constructor=f};k.prototype=d.prototype;f.prototype=new k;a&&e.extend(f.prototype,a);f.__super__=d.prototype;return f};var L=function(){throw Error('A "url" property or function must be specified');},C=function(a,b){var d=b.error;b.error=function(e){d&&d(a,e,b);a.trigger("error",a,e,b)}}}).call(this);window.SVBackbone=Backbone.noConflict();SVBackbone.$=$svjq;
(function(){function d(b,d,p){var l=window.sv.ErrorUtil;l&&l.handleBackboneError(b,d,p)}var m=window.SVBackbone,n=m.Model.prototype.fetch,q=m.Model.prototype.save,b=m.Model.prototype.destroy,l=m.Collection.prototype.fetch;m.Model.prototype.fetch=function(b){b=b||{};b.error=b.error||d;return n.apply(this,[b])};m.Model.prototype.save=function(b,e,p){null==b||"object"===typeof b?(e=e||{},e.error=e.error||d):(p=p||{},p.error=p.error||d);return q.apply(this,[b,e,p])};m.Model.prototype.destroy=function(f){f=
f||{};f.error=f.error||d;return b.apply(this,[f])};m.Collection.prototype.fetch=function(b){b=b||{};b.error=b.error||d;return l.apply(this,[b])}})();
(function(){var d=window.sv,m=d.ObjectUtil,n=d.Log,q=window.$svjq,b=window._sv,l=function(b){return(b=(new RegExp("[\\?&]"+b+"=([^&#]*)")).exec(window.location.href))?b[1]:null},f=function(b,d,e){var f;f="string"===q.type(b)?q(b):b;q.get(d,function(b){f.fadeOut("fast",function(){f.html(b);f.fadeIn();q.isFunction(e)&&e.call(this)})})},e={};d.PortletUtil={getModelObjectUri:function(b,e,f){b="/modelobjectapi/1/"+d.PageContext.pageId+"/"+b+"/"+e;f&&(b+="/"+f);return b},getEditApiUri:function(b){var e=
b.modelHandler,f=b.objectId,s=b.operationObjectId,r=b.contextNodeId||d.PageContext.pageId;"string"===typeof b&&(e=b);f||(f=d.PageContext.pageId);b="/edit-api/1/"+r+"/"+f+"/"+e;s&&(b+="/"+s);return b},getPortletUri:function(b,e){return"/"+d.PageContext.pageId+"/"+b+".xml?state="+e},getPortletResourceUri:function(b,e){var f=l("identity"),s=l("group"),r=l("tag");return"/portletresource/"+d.PageContext.pageId+"/"+b+"?state="+e+(f?"&identity="+f:"")+(s?"&group="+s:"")+(r?"&tag="+r:"")},reloadPortletsByType:function(b,
e){var k=q(b);q.each(k,function(){var b=q(this),k=b.attr("id"),k=m.getObjectId(k);f(b,"/"+d.PageContext.pageId+"/"+k+".xml"+(e||""))})},doGetWithFade:f,doGet:function(b,d){q.get(d,function(d){q(b).html(d)})},getTemplate:function(d,f){var k=d.attr("id"),s;if(k){k=k.replace(".","_");if(!e[k+f]){s=d.find("script.sv-tmpl-"+f);if(0===s.length){n.warn("portletUtil","Could not find template with name "+f+" for portlet "+k);return}e[k+f]=b.template(s.html())}return e[k+f]}n.warn("portletUtil","Tried to get template from invalid element")}}})();
(function(){var d=window.$svjq,m=window.sv,n=m.KeyUtil,q=m.DialogUtil,b=m.PortletUtil,l=m.DateUtil,f=m.Events,e=window.moment,p=window.SVBackbone,u=d("html").hasClass("sv-touch"),k=function(a,b){return m.i18n.getText("common",a,b)},s,r=p.View.extend({template:function(){return b.getTemplate(this.options.$portlet,this.templateName)},memberTemplate:function(){return b.getTemplate(this.options.$portlet,this.memberTemplateName)},participantTemplate:function(){return b.getTemplate(this.options.$portlet,
this.participantTemplateName)},events:{"click [data-fn-allday]":"toggleTimeVisibility",'keyup [name="where"]':"showMapLink"},initialize:function(a){this.options=a;this.originalValues={};a=this.template();var b=d.extend(this.model.toJSON(),this.templateHelpers);this.$el.append(a(b));this.listenTo(this.model,"invalid",this.handleErrors);this.ui={startDate:this.$el.find("[name=startDate]"),startTime:this.$el.find("[data-fn-time-value-start]"),endDate:this.$el.find("[name=endDate]"),endTime:this.$el.find("[data-fn-time-value-end]"),
allDay:this.$el.find("[name=allDay]"),isDone:this.$el.find("[name=isDone]"),owner:this.$el.find("#owner"),participants:this.$el.find("#participants")}},render:function(){var a=this,f=[{text:k("cancel"),callback:function(){d(".modal").modal("hide");a.restoreChanges()}}];this.model.isNew()?f.push({text:this.i18n("create"),skipDismiss:!0,primary:!0,callback:function(){a.saveChanges()}}):f.push({text:k("remove"),danger:!0,callback:d.proxy(this.removeActivity,this)},{text:k("ok"),skipDismiss:!0,primary:!0,
callback:function(){a.saveChanges()}});q.showDialog({title:this.model.attributes.isTask?this.i18n("task"):this.i18n("event"),body:this.$el,buttons:f,removeOnHide:!0,errorTitle:k("networkErrorTitle"),errorMsg:k("networkErrorText")});f={format:e.localeData()._longDateFormat.L.toLowerCase(),autoclose:!0};this.ui.startDate.bootstrapDatepicker(f).on("change",d.proxy(function(){var a=this.ui.endDate.val(),b=this.ui.startDate.bootstrapDatepicker("getDate");!a&&b&&this.ui.endDate.bootstrapDatepicker("setDate",
b)},this));this.ui.endDate.bootstrapDatepicker(f);var f=this.$el.parent().parent(),r={decimal:k("decimal"),mins:k("mins"),hr:k("hr"),hrs:k("hrs")},s=l.moment2PhpFormat(e.localeData()._longDateFormat.LT);this.ui.startTime.timepicker({timeFormat:s,lang:r,appendTo:f,scrollDefaultNow:!0}).on("timeFormatError",d.proxy(function(){var a=e();this.ui.startTime.val(a.format("LT"))},this)).on("change",d.proxy(function(){var a;!this.ui.endTime.val()&&this.ui.startTime.val()&&(a=e(this.ui.startTime.val(),"LT",
!0),a.add(2,"hours"),this.ui.endTime.val(a.format("LT")))},this));this.ui.endTime.timepicker({timeFormat:s,lang:r,appendTo:f}).on("timeFormatError",d.proxy(function(){var a=this.ui.startTime.val();a?(a=e(a,"LT",!0),a.add(2,"hours")):a=e();this.ui.endTime.val(a.format("LT"))},this));d.ajax({url:b.getPortletResourceUri(this.options.portletId,this.membersWithOwnerActionName)+(this.model.isNew()?"":"&id="+this.model.id)}).done(d.proxy(function(a){this.ui.owner.select2({allowClear:!0,data:a,formatResult:this.memberTemplate(),
escapeMarkup:function(a){return a}})},this));d.ajax({url:b.getPortletResourceUri(this.options.portletId,this.membersActionName)}).done(d.proxy(function(a){this.ui.participants.select2({multiple:!0,data:a,formatResult:this.memberTemplate(),formatSelection:this.participantTemplate(),escapeMarkup:function(a){return a}})},this))},handleErrors:function(a,b){y(a,b,this.$el,this.i18n)},templateHelpers:{mapUrl:function(a){return v(a)},datePickerValue:function(a){return e(a).isValid()?e(a).format("L"):""},
timePickerValue:function(a){return e(a).isValid()?"00:00"===e(a).format("LT")||"12:00 AM"===e(a).format("LT")?"":e(a).format("LT"):""}},showMapLink:function(a){this.typingTimer&&window.clearTimeout(this.typingTimer);this.typingTimer=window.setTimeout(d.proxy(function(){var b=v(a.currentTarget.value);if(!this.$mapLink&&(this.$mapLink=this.$el.find("[data-fn-map-link]"),!this.$mapLink.length)){var e='<span class="help-block"><i class="halflings-icon icon-map-marker"></i> <a data-fn-map-link class="sv-map-link" target="_blank" href="'+
b+'">'+this.i18n("map")+"</a></span>";this.$mapLink=d(e).insertAfter(a.currentTarget).find("[data-fn-map-link]")}a.currentTarget.value?this.$mapLink.closest(".help-block").show():this.$mapLink.closest(".help-block").hide();this.$mapLink.attr("href",b)},this),1E3)},toggleTimeVisibility:function(){this.ui.startTime.toggleClass("sv-hidden");this.ui.endTime.toggleClass("sv-hidden")},setAndSaveForRestore:function(a,b){this.originalValues[a]||(this.originalValues[a]=this.model.get(a));this.model.set(a,
b)},restoreChanges:function(){var a=this;d.each(this.originalValues,function(b,d){a.model.set(b,d)})},setAndSaveDateForRestore:function(a,b,d){b.length?(b=e(b,"L",!0),d=e(d,"LT",!0),b.hours(d.hours()).minutes(d.minutes()),this.setAndSaveForRestore(a,b.valueOf())):this.setAndSaveForRestore(a,"")},saveChanges:function(){var a=this;this.$el.find("[data-fn-standard-value]").each(function(){a.setAndSaveForRestore(this.name,d.trim(this.value))});var b=this.ui.allDay.prop("checked");this.setAndSaveForRestore("allDay",
b);var b=d.trim(this.ui.startDate.val()),e=d.trim(this.ui.startTime.val());this.setAndSaveDateForRestore("start",b,e);b=d.trim(this.ui.endDate.val());e=d.trim(this.ui.endTime.val());this.setAndSaveDateForRestore("end",b,e);b=this.ui.isDone.prop("checked");this.setAndSaveForRestore("isDone",b);var k=this.model.isNew();this.model.save(null,{wait:!0,success:function(b){a.backingModel.set(b.attributes);d(".modal").modal("hide");k?f.trigger(f.types.activityCreated,b.attributes):f.trigger(f.types.activityUpdated,
b.attributes)},error:function(){d(".alert").show()}})}}),w=p.View.extend({template:function(){return b.getTemplate(this.options.$portlet,this.templateName)},events:{"click [data-fn-more]":"more","click [data-fn-remove]":"removeActivity","click [data-fn-edit]":"editActivity","mouseenter [data-participants]":"showParticipants","mouseleave [data-participants]":"hideParticipants"},initialize:function(a){this.options=a;a=this.template();var b=d.extend(this.model.toJSON(),this.templateHelpers());s=this.options.i18n;
this.$el.append(a(b));s=null;this.ui={description:this.$el.find("[data-fn-description]"),more:this.$el.find("[data-fn-more-remainder]"),participants:this.$el.find("[data-participants]")}},render:function(){var a=d("<div/>").text(this.model.get("title")).html(),b=z(this.options.$target);f.trigger(f.types.popoverCreated,this);this.options.$target.popover({html:!0,title:'<button type="button" class="close">&times;</button>'+a,placement:b,content:this.el,trigger:"manual",container:this.options.popoverContainer}).popover("show");
a=this.$el.closest(".popover");if(this.options.jsEvent){var e=this.options.jsEvent.pageY;if("top"===b)e-=a.height()+10;else if("left"===b||"right"===b)e-=a.height()/2;a.css({top:e})}a.on("click",".close",d.proxy(this.closePopover,this)).on("clickoutside",d.proxy(this.closePopover,this));d(document).on("keydown",d.proxy(this.closePopoverOnEscape,this));d("[data-fn-request-focus]").focus();f.on(f.types.popoverCreated,d.proxy(this.closePopoverWhenOtherIsCreated,this));return this},templateHelpers:function(){var a=
{maxSizeText:function(a){a=d("<div/>").text(a).html();if(150>a.length)return a;var b="<span>"+a.substring(0,150)+'</span><span data-fn-more class="sv-more">&nbsp;...'+s("more")+" &raquo;</span>";return b+='<span data-fn-more-remainder class="sv-hidden">'+a.substring(150)+"</span>"},mapUrl:function(a){return v(a)}};this.templateHelpers2&&(a=d.extend(a,this.templateHelpers2));return a},showParticipants:function(){var a=this.model.get("participants");a&&0<a.length&&(this.participants?this.showParticipantsTooltip():
d.ajax({url:b.getPortletResourceUri(this.options.portletId,this.participantsActionName)+"&id="+this.model.id}).done(d.proxy(function(a){this.participants=a;this.showParticipantsTooltip()},this)))},showParticipantsTooltip:function(){this.ui.participants.tooltip({html:!0,title:this.participants.join("<br/>")});this.ui.participants.tooltip("show")},hideParticipants:function(){this.ui.participants.tooltip("destroy")},more:function(a){d(a.currentTarget).addClass("sv-hidden");this.ui.description.css("max-height",
this.ui.description.height()+20+"px").addClass("sv-show-scroll");this.ui.more.removeClass("sv-hidden")},closePopover:function(){f.off(f.types.popoverCreated);d(document).off("keydown",this.closePopoverOnEscape);this.$el.closest(".popover").off("click",".close",this.closePopover).off("clickoutside",this.closePopover).remove();this.options.$target.popover("destroy")},editActivity:function(){this.model.fetch({success:d.proxy(function(a){this.createEditView(a).render();u&&d(window).scrollTop(0)},this)});
this.closePopover();return!1},closePopoverWhenOtherIsCreated:function(a){this!==a&&this.closePopover()},closePopoverOnEscape:function(a){if(a.keyCode===n.KEY.ESC)return this.closePopover(),!1}}),p=p.Model.extend({defaults:{title:"",description:"",where:"",owner:"",participants:"",start:"",end:""},initialize:function(a,b){this.portletId=b.portletId},validate:function(a){var b=[];a.title||b.push({field:"title",message:"noTitle"});a.owner||b.push({field:"owner",message:"noOwner"});if(!this.allowEmptyStart&&
!a.start)b.push({field:"start",message:"noStart"});else if(a.allDay||a.end)a.start||b.push({field:"start",message:"noStart"});if(a.start&&a.end){var d=e(a.start),f=e(a.end);a.allDay&&f.isSame(d)||f.isAfter(d)||b.push({field:"end",message:a.allDay?"invalidAllDayTimePeriod":"invalidTimePeriod"})}!a.allDay&&a.start&&(a.end||b.push({field:"end",message:"noEnd"}));return b.length?b:void 0}}),y=function(a,b,d,e){a=0;var f=b.length,k;for(d.find(".control-group").removeClass("error").find(".help-block.error").remove();a<
f;a++)k=b[a],d.find('[name="'+k.field+'"]').closest(".control-group").addClass("error").find(".controls").append('<span class="help-block error">'+e(k.message)+"</span>")},z=function(a){if(u)return"bottom";var b=a.offset().top-d(window).scrollTop(),e=window.innerHeight-b;a=a.offset().left-d(window).scrollLeft();return 220<=e?"bottom":220<=b?"top":a>=window.innerWidth-a?"left":"right"},v=function(a){return"https://maps.google.se/maps?hl="+m.PageContext.userLocale+"&q="+a+"&source=calendar"};e.locale(m.PageContext.userLocale);
m.ActivityUtil={showErrors:y,calculatePopoverPlacement:z,stripYear:function(a,b){var d=""+e(a).year();return b.replace(new RegExp(d,"g"),"").replace(/  /g," ")},ActivityModel:p,ActivityDetailView:w,ActivityEditView:r}})();
(function(){function d(b){for(var d=0,e=b.length,f=[],k;d<e;d++)k=b[d],f.push({key:k,value:u(k)});return f}function m(b){b.groupTypes=d(b.groupTypes);var e=n(s(b)),f=[{text:q.i18n.getText("common","cancel")},{text:q.i18n.getText("common","ok"),skipDismiss:!0,primary:!0,callback:function(){var d=q.PortletUtil.getPortletResourceUri(b.portletId,"groupAdministration");n.ajax({type:"POST",dataType:"JSON",data:n(".sv-fn-create-group-form").serialize(),url:d,success:function(b){n(".modal").modal("hide");
location.href=b.showGroupURL},error:function(b){n(".alert").show();b=n.parseJSON(b.responseText);var a=n(".alert").find(".alert-title");a.data("orginal-title",a.text());a=n(".alert").find(".alert-message");a.data("orginal-message",a.text());b.type&&a.text(u(b.type.toLowerCase()));e.find("input").first().focus().closest(".control-group").addClass("error")}})}}];q.DialogUtil.showDialog({title:u("createGroupLabel"),body:e,buttons:f,removeOnHide:!0,errorTitle:u("createGroupError"),errorMsg:u("groupAlreadyExists")})}
var n=window.$svjq,q=window.sv,b=q.KeyUtil,l=b.KEY,f={},e,p=window._sv,u=function(b,d){var e;if(!d&&f[b])return f[b];e=q.i18n.getText("portlet.util.addgrouputil",b,d);d||(f[b]=e);return e},k={success:function(){},selected:function(){},placeholder:"",groupTemplates:[],groupFolder:null,hitTemplate:p.template('<li data-group-id="<%= id %>" class="sv-clearfix <% if (isMember) { %> sv-group-member<% } %>">   <img class="sv-group-img sv-buddy-icon" src="<%= iconURL %>" />   <% if (isMember) { %><div style="float:right"><i class="halflings-icon ok"></i></div><% } %>   <div class="sv-group-info-container">     <h3 class="sv-group-name"><%- name %></h3>     <p>        <%= memberCount %> medlemmar     </p>   </div></li>')},
s=p.template('<form class="form-horizontal sv-fn-create-group-form">    <div class="control-group">       <label class="control-label">'+u("name")+'</label>       <div class="controls">          <input class="input-xlarge" data-fn-groupname type="text" name="name" required value="<%= name %>" />          <span class="help-block help">'+u("nameHelp")+'</span>       </div>    </div>    <div class="control-group">       <label class="control-label">'+u("description")+'</label>       <div class="controls">          <textarea class="input-xlarge" data-fn-groupdescription data-fn-request-focus rows="3" type="text" name="description"></textarea>          <span class="help-block help">'+
u("descriptionHelp")+'</span>       </div>    </div>    <% if (templates.length > 1) { %>    <div class="control-group">       <label class="control-label">'+u("template")+'</label>       <div class="controls">          <select name="template">            <% for(var idx in templates) { %>               <option value="<%= templates[idx].id %>"><%= templates[idx].name %></option>            <% } %>          </select>          <span class="help-block help">'+u("templateHelp")+'</span>       </div>    </div>    <% } else { %>    <input type="hidden" name="template" value="<%= templates[0].id %>">    <% } %>    <div class="control-group">       <label class="control-label">'+
u("type")+'</label>       <div class="controls">          <select name="type">            <% for(var idx in groupTypes) { %>               <option value="<%= groupTypes[idx].key %>"><%= groupTypes[idx].value %></option>            <% } %>          </select>          <span class="help-block help">'+u("typeHelp")+"</span>       </div>    </div> </form>");q.AddGroupUtil={showSearchPopover:function(d){var f=n.extend({},k,d),s=n(f.target),p=0;if(s.hasClass("sv-fn-popover-showing"))s.popover("destroy").removeClass("sv-fn-popover-showing");
else{d='<form class="form-search" onsubmit="return false;"><input type="text" placeholder="'+(f.placeholder||"")+'" data-fn-group-search class="span2 search-query"/></form>';f.groupFolder&&(d='<form class="form-search" onsubmit="return false;"><div class="input-append"><input type="text" placeholder="'+(f.placeholder||"")+'" data-fn-group-search class="span1 search-query"/><button type="button" class="btn btn-small sv-fn-create-group">'+u("createGroup")+"</button></div></form>");s.popover("destroy").addClass("sv-fn-popover-showing").popover({html:!0,
title:d,placement:"bottom",content:'<ul class="sv-group-search-list sv-defaultlist"></ul>',trigger:"manual"});s.popover("show");var v=function(a){n(a.target).is(".popover *")||(s.popover("destroy").removeClass("sv-fn-popover-showing"),n("body").unbind("click",v))};n("body").bind("click",v);s.parent().find("[data-fn-group-search]").focus().closest(".popover").addClass("sv-groupsearch-popover");s.parent().find(".popover").on("click",".sv-fn-create-group",function(){m({name:s.parent().find("[data-fn-group-search]").val(),
folder:f.groupFolder,templates:f.groupTemplates,groupTypes:f.groupTypes,portletId:f.portletId})});var a=s.parent().find(".popover-content").find("ul"),A=[];s.parent().find("[data-fn-group-search]").keydown(function(d){d=b.getKeyCodeFromEvent(d);if(d===l.DOWN)return p++,p>A.length-1&&(p=0),a.children().removeClass("active").eq(p).addClass("active"),!1;if(d===l.UP)return p--,0>p&&(p=A.length-1),a.children().removeClass("active").eq(p).addClass("active"),!1}).keyup(function(d){d=b.getKeyCodeFromEvent(d);
if(d===l.ESC)return s.popover("destroy"),!1;if(d===l.RETURN){if("undefined"!==typeof A[p])return s.popover("destroy"),f.selected&&f.selected.call(this,A[p]),!1;-1===p&&m({name:n(this).val(),folder:f.groupFolder,template:f.groupTemplate,groupTypes:f.groupTypes,portletId:f.portletId})}else{if(b.isNonTextModifiableKeyCode(d))return!1;var k=this;e&&clearTimeout(e);e=setTimeout(function(){p=-1;a.empty();var b=n(k).val();n.ajax({url:q.PortletUtil.getModelObjectUri(q.PageContext.pageId,"groupSearch",q.PageContext.pageId),
data:{term:b},dataType:"json"}).done(function(b){b.queryString===n(k).val()&&(p=0,a.empty(),A=b.hits,n.each(A,function(b,d){var e=n(f.hitTemplate(d));a.append(e);e.click(function(){s.popover("destroy");f.selected&&f.selected.call(this,d);return!1}).mouseenter(function(){a.children().removeClass("active");p=b;n(this).addClass("active")})}),f.success&&f.success.call(this,A))})},200)}})}}}})();
window.$svjq(function(){function d(d){e=window.setTimeout(function(){if(l&&0<p.length){var d=p[p.length-1];p=["0"];n.ajax({method:"PUT",url:"/modelobjectapi/1/"+b.pageId+"/"+b.pageId+"/groupViewed/"+b.pageId,data:JSON.stringify({uuid:d})}).success(function(){q.trigger(q.types.groupPageViewed)}).fail(function(b){switch(b.status){case 401:case 403:l=!1}})}e=void 0},d||f)}var m=window.sv,n=window.$svjq,q=m.Events,b=m.PageContext,l=!0,f=1E3*b.userIdentityReadTimeout,e,p=["0"];b&&b.pageId&&b.pageId.match("^704\\.")&&
(d(),q.on("server-group-updated-"+b.pageId,function(b){p.push(b.uuid);e?window.setTimeout(function(){window.clearTimeout(e);d(f/2)},f/2):d()}))});
(function(){var d=window.$svjq,m=window.sv,n=m.Log,q=m.Events,b=window._sv.template('<i class="halflings-icon thumbs-up"></i><b><%= likeText %></b> (<%= likeCount %>)'),l={},f=function(b){return l[b]?l[b]:m.i18n.getText("portlet.util.likableutil",b)},e=function(d){var e=d.data("like-count")||0,k=!!d.data("user-likes");d.html(b({likeText:k?f("likes"):f("like"),likeCount:e,userLikes:k}));d[k?"addClass":"removeClass"]("sv-liked")},p=function(b){b=b||d("body");b.is("[data-fn-likable],[data-fn-portlet-likable]")?
e(b):b.find("[data-fn-likable],[data-fn-portlet-likable]").each(function(){e(d(this))})},u=function(b,d){b.tooltip({html:!0,title:d.join("<br/>")});b.tooltip("show")},k=function(){var b=d(this),f=!!b.data("user-likes"),k=b.data("likable-id"),l;b.removeData("likes");b.tooltip("destroy");if(!k)n.warn("Trying to like object without likable-id in portlet "+b.closest(".sv-portlet").attr("id"));else if(!b.hasClass("sv-disabled"))return b.addClass("sv-disabled"),l=b.closest(".sv-portlet"),l=m.ObjectUtil.getObjectId(l.attr("id")),
l=f?m.PortletUtil.getPortletResourceUri(l,"unlike")+"&likable="+k:m.PortletUtil.getPortletResourceUri(l,"like"),d.ajax({url:l,method:f?"DELETE":"POST",dataType:"JSON",data:{likable:k}}).done(function(d){b.data("user-likes",!f).data("like-count",d.count);e(b)}).fail(function(b){m.ErrorUtil.handleAjaxFailure(b)}).always(function(){b.removeClass("sv-disabled")}),!1};m.LikableUtil={toggleLike:k};d("body").on("click.likeable","a[data-fn-likable]",k);d(document).on("mouseenter",".sv-like",function(){var b=
d(this),e=b.closest(".sv-portlet"),e=m.ObjectUtil.getObjectId(e.attr("id")),f=b.data("likable-id"),k=b.data("likes");0<b.data("like-count")&&(k?u(b,k):(e=m.PortletUtil.getPortletResourceUri(e,"likes")+"&likable="+f,d.ajax({url:e,method:"GET",dataType:"JSON"}).done(function(d){b.data("likes",d);u(b,d)}).fail(function(b){m.ErrorUtil.handleAjaxFailure(b)})))});d(document).on("mouseleave",".sv-like",function(){d(this).tooltip("destroy")});q.on(q.types.updateLikables,p);p()})();
(function(){var d=window.sv,m=window.$svjq,n=d.Events,q={includeHandle:!1,ajaxOptions:{timeout:5E3}},b=function(b){return/wikipedia.org|facebook.com\/groups/.test(b)};n.on(n.types.updateOembedLinks,function(l,f){function e(b){var d=document.createElement("a");d.href=b;b=d.hostname.split(".");d=b.length;b=1<d?b[d-2]:void 0;return b&&-1<n.indexOf(b)}function p(b){if("IFRAME"===b.prop("tagName")&&e(b[0].src))return m('<div class="sv-iframeEmbed-16_9" />').append(b);if(b.find("iframe").length&&e(b.find("iframe")[0].src))return b.find("iframe").wrap('<div class="sv-iframeEmbed-16_9" />'),
b;if(b.hasClass("fb-post"))return b.attr("data-width","auto"),b}if(l&&l.length&&(!l.hasClass("sv-embedded")||l.hasClass("sv-embeddedmedia-portlet"))){var n="youtube vimeo wistia bambuser streamio dreambroker".split(" "),k=l.find("a.sv-embed").first();if(k.length&&!b(k.attr("href"))){q.onEmbed=function(b){if(b&&b.code){b=b.code;if("string"===typeof b)try{b=m(b)}catch(d){return}if(b instanceof m){var e=p(b),f=!!e;b=f?e:b;if(1!==b.length||!b.is(":empty")){var e=this.closest(".sv-message-content"),e=
0<e.length?e.first():this.parent(),k=m("<a>",{href:this.attr("href"),target:"_blank"}),a=!f,f=m(f?'<div class="oembedall-container no-max-height"></div>':'<div class="oembedall-container"></div>');b.find("p").each(function(){var a=m(this),b=a.text();b&&200<b.length&&a.text(b.substring(0,190)+"...")});try{a?b.clone().wrap(k).parent().appendTo(f):b.clone().appendTo(f)}catch(l){a?f.append(b.wrap(k).parent()):f.append(b)}q.replace?this.replaceWith(f):e.after(f)}}}};q=m.extend(q,f);try{k.oembed(null,q),
l.addClass("sv-embedded")}catch(s){d.Log.error("oembedutil","Could not embed link. Error: "+s.message)}}}})})();(function(){var d=window.$svjq,m=window.moment,n=window.sv.Events,q=d("html").attr("lang")||"en",b=function(b){b=b||d("body");b.find("time[data-fn-relative-date]").each(function(){var b=d(this),e=b.attr("datetime"),l=b.data("short");m.locale(l?q+"-short":q);if(e=m(e))b.text(e.fromNow()),b.attr("title",e.format("LLLL"))})};window.setInterval(b,6E4);n.on(n.types.updateRelativeDates,b);b()})();
(function(){var d=window.$svjq,m=window.sv,n=m.PortletUtil,q=m.KeyUtil,b=q.KEY,l={},f,e=window._sv,p={success:function(){},selected:function(){},placeholder:"",markAdmins:!1,hitTemplate:e.template('<li data-user-identity="<%= id %>" class="sv-clearfix">   <img class="sv-contact-img sv-buddy-icon" src="<%= iconURL %>" />   <% if ((typeof(isMember) !== \'undefined\' && isMember) || (typeof(isAdmin) !== \'undefined\' && isAdmin) || (typeof(isContact) !== \'undefined\' && isContact)) { %><div style="float:right"><i class="halflings-icon ok"></i></div><% } %>   <div class="sv-user-info-container">     <h3 class="sv-contact-name"><%= name %></h3>     <p>     <% _.each(userfields, function(field) { %>        <%= field.value %><br/>     <% }); %>     </p>   </div></li>'),
adminHitTemplate:e.template('<li data-user-identity="<%= id %>" class="sv-clearfix">   <img class="sv-contact-img sv-buddy-icon" src="<%= iconURL %>" />   <% if ((typeof(isAdmin) !== \'undefined\' && isAdmin)) { %><div style="float:right"><i class="halflings-icon ok"></i></div><% } %>   <div class="sv-user-info-container">     <h3 class="sv-contact-name"><%= name %></h3>     <p>     <% _.each(userfields, function(field) { %>        <%= field.value %><br/>     <% }); %>     </p>   </div></li>')},u=
function(b,d){var e;if(!d&&l[b])return l[b];e=m.i18n.getText("portlet.util.searchuserutil",b,d);d||(l[b]=e);return e};m.SearchUserUtil={showSearchPopover:function(e){var l=d.extend({},p,e),r=d(l.target),w=0;if(r.hasClass("sv-fn-popover-showing"))d(".popover").remove(),r.removeClass("sv-fn-popover-showing");else{d(".popover").remove();r.addClass("sv-fn-popover-showing").popover({html:!0,container:0<r.closest(".modal").length?r.closest(".modal"):!1,title:'<input type="text" placeholder="'+(l.placeholder||
"")+'" data-fn-user-search class="input-medium search-query"/>',placement:"bottom",content:'<ul class="sv-user-search-list sv-defaultlist"></ul>',trigger:"manual"});r.popover("show");var y=function(a){d(a.target).is(".popover *")||(d(".popover").remove(),r.removeClass("sv-fn-popover-showing"),d("body").unbind("click",y))};d("body").bind("click",y);d("[data-fn-user-search]").focus().closest(".popover").addClass("sv-usersearch-popover");var z=n.getModelObjectUri(m.PageContext.pageId,"userIdentitySearch",
m.PageContext.pageId)+"?userfields=true",v=d(".popover-content").find("ul"),a=[];l.group&&(z+="&group="+l.group);l.userIdentity&&(z+="&identity="+l.identity);v.css("max-height",window.innerHeight-v.offset().top-10+"px");d("[data-fn-user-search]").keydown(function(d){d=q.getKeyCodeFromEvent(d);if(d===b.DOWN){w++;if(l.searchUrl&&w>a.length||!l.searchUrl&&w>a.length-1)w=0;v.children().removeClass("active").eq(w).addClass("active");return!1}if(d===b.UP)return w--,0>w&&(w=l.searchUrl?a.length:a.length-
1),v.children().removeClass("active").eq(w).addClass("active"),!1}).keyup(function(e){e=q.getKeyCodeFromEvent(e);if(e===b.ESC)return d(".popover").remove(),r.removeClass("sv-fn-popover-showing"),!1;if(e===b.RETURN){if(w===a.length)return 0<w&&"undefined"!==typeof v.children().eq(w).find("a").attr("href")?location.href=v.children().eq(w).find("a").attr("href"):""!==d(this).val()&&(location.href=l.searchUrl+"&query="+d(this).val()),!1;if("undefined"!==typeof a[w])return d(".popover").remove(),r.removeClass("sv-fn-popover-showing"),
l.selected&&l.selected.call(this,a[w]),!1}else{if(q.isNonTextModifiableKeyCode(e))return!1;var k=this;f&&clearTimeout(f);f=setTimeout(function(){w=0;v.empty();var b=d(k).val();""!==b&&d.ajax({url:z,dataType:"json",data:{term:b}}).done(function(e){e.queryString===d(k).val()&&(w=0,v.empty(),a=e.hits,d.each(a,function(a,b){var e=l.markAdmins?d(l.adminHitTemplate(b)):d(l.hitTemplate(b));v.append(e);e.click(function(){d(".popover").remove();r.removeClass("sv-fn-popover-showing");l.selected&&l.selected.call(this,
b);return!1}).mouseenter(function(){v.children().removeClass("active");w=a;d(this).addClass("active")})}),l.searchUrl&&0<a.length&&(e=u("showAll"),10>a.length&&(e=u("showAsList")),d('<li class="sv-showmore"><a href="'+l.searchUrl+"&query="+b+'">'+e+"</a></li>").appendTo(v).mouseenter(function(){v.children().removeClass("active");w=a.length}).click(function(){location.href=d(this).find("a").attr("href");return!1}),w=a.length),v.children().eq(w).addClass("active"),l.success&&l.success.call(this,a))})},
200)}})}}}})();
(function(){function d(b,d){var e;if(!d&&p[b])return p[b];e=n.i18n.getText("portlet.util.userinformation",b,d);d||(p[b]=e);return e}function m(d){var l=d.data("user-identity"),m=d.data("fn-show-user-popup-subtitle"),m=b.escape(d.attr("title"))+(m?"<small> "+b.escape(m)+"</small>":""),l=f.getModelObjectUri(n.PageContext.pageId,"userStatus",l);d.addClass("user-popover-loaded").webuiPopover({trigger:"hover",delay:300,type:"async",title:m,placement:"auto",url:l,content:function(b){b=JSON.parse(b);e.extend(b,
{showAddContact:b.userIdentityAvailable&&b.requestedUserIdentityAvailable,showSendMessage:b.userIdentityAvailable&&b.requestedUserIdentityAvailable&&0<e(".sv-messages-portlet").length});return(new k({model:new u(b)})).getContent()}})}var n=window.sv,q=window.SVBackbone,b=window._sv,l=n.Events,f=n.PortletUtil,e=window.$svjq,p={},u=q.Model.extend({defaults:{fields:[],contacts:0,groups:0,showSendMessage:!1},url:function(){return f.getModelObjectUri(n.PageContext.pageId,"userStatus",this.id)}}),k=q.View.extend({tagName:"div",
className:"bootstrap",template:b.template('<div class="bootstrap"><img style="float:left; margin-right:8px;" class="sv-buddy-icon" src="<%= largeBuddyIcon %>" /><div style="overflow: hidden" class="sv-userfields">    <% _.each(fields, function(field) { %>       <%- field %><br/>    <% }); %></div><div style="clear:left; padding-top:10px; margin-bottom:3px" class="sv-clearfix">    <div style="float:left;margin-top: 7px;"><img src="/sitevision/core/<%= status %>.png"/></div>       <div style="float:left;margin-top: 4px;"><small><%= statusText %></small></div>       <div style="float:right;padding-left: 10px;">         <% if (showAddContact && contact === \'false\') { %>           <button data-user-identity="<%= id %>" class="btn btn-mini btn-default sv-add-contact">'+
d("addAsContact")+'</button>         <% } %>         <% if (showSendMessage && self === \'false\') { %>           <button data-user-identity="<%= id %>" class="btn btn-mini btn-primary sv-send-message"><i class="halflings-icon comments white"></i> '+d("message")+"</button>         <% } %>       </div>    </div></div>"),getContent:function(){return this.template(this.model.toJSON())}});e("body").on("mouseenter","[data-user-identity][data-fn-show-user-popup]",function(){var b=e(this);b.hasClass("user-popover-loaded")||
(m(b),b.trigger("mouseenter"))});e("body").on("click","button.sv-send-message[data-user-identity]",function(){var b=e(this);l.trigger("sendMessage",b.data("user-identity"));b.closest("[data-user-identity][data-fn-show-user-popup]").webuiPopover("hide");return!1});e("body").on("click","button.sv-add-contact[data-user-identity]",function(){var b=e(this);e.post(f.getModelObjectUri(n.PageContext.userIdentityId,"addContact"),{id:b.data("user-identity")});e('[data-user-identity="'+b.data("user-identity")+
'"][data-fn-show-user-popup]').removeClass("user-popover-loaded").webuiPopover("destroy");return!1})})();
(function(){function d(d){d=d.serializeArray();var e={};b.each(d,function(b,d){e[d.name]=d.value});return e}var m=window.sv,n=m.PortletUtil,q=m.DialogUtil,b=window.$svjq,l=function(b){return m.i18n.getText("portlet.social.userfields.userfields",b)},f=function(b){return m.i18n.getText("common",b)},e=function(b){var d=!0;"function"===typeof b.checkValidity&&(d=b.checkValidity());return d};m.UserSettingsUtil={popupUserSettingsDialog:function(p){var u=b("<div/>").addClass("sv-userfields-content"),k=b("<form/>").addClass("form-horizontal sv-userfields-form");
u.append(k);b.ajax({type:"GET",dataType:"json",url:n.getModelObjectUri(m.PageContext.userIdentityId,"userfields",m.PageContext.userIdentityId),data:{fields:p||"all"},success:function(p){b.each(p.fields,function(d,e){var f=b("<div/>").addClass("control-group");k.append(f);var a=b("<label/>").addClass("control-label").text(e.name);f.append(a);a=b("<div/>").addClass("controls");f.append(a);"true"===e.writeable?(f="text_field"===e.type?b("<textarea/>").attr({rows:"3",id:e.id,name:e.id,"data-errorMsg":e.validationErrorMessage}).addClass("input-xlarge"):
b("<input/>").attr({type:e.type,id:e.id,name:e.id,"data-errorMsg":e.validationErrorMessage}).addClass("input-xlarge"),"no_validation"!==e.validationType&&("reg_exp_validation"===e.validationType&&e.regularExpression&&f.attr("pattern",e.regularExpression),e.value&&f.attr("required",""),f.attr("data-validation","true")),a.append(f),e.value&&f.val(e.value),e.description&&(f=b("<span/>").addClass("help-block help").text(e.description),a.append(f))):e.value&&a.append(b("<label/>").attr({title:e.description}).css("padding-top",
"5px").text(e.value))});if(p.passwordRequired){var r=b("<div/>").addClass("control-group").addClass("well");k.append(r);var w=b("<label/>").addClass("control-label").text(l("password_field_title"));r.append(w);w=b("<div/>").addClass("controls");r.append(w);r=b("<input/>").attr({id:"password",name:"password",type:"password"}).addClass("input-xlarge");w.append(r);r=b("<span/>").addClass("help-block help").text(l("password_field_description"));w.append(r)}k.find("input").not('[type="password"]').on("keyup",
function(d){d=b(d.target);d.val().length&&d.attr("data-validation")?d.attr("required","required"):d.removeAttr("required")});w=[{text:f("cancel")},{text:f("ok"),skipDismiss:!0,primary:!0,callback:function(){b(".help-block").remove(".error");b(".help-block").remove(".serverside-error");b(".control-group").removeClass("error");b(".alert").hide();if(e(k.get(0))){var q=d(k);b.ajax({type:"PUT",dataType:"JSON",url:n.getModelObjectUri(m.PageContext.userIdentityId,"userfields",m.PageContext.userIdentityId),
data:JSON.stringify(q),processData:!1,success:function(d){if(d.success)n.reloadPortletsByType(".sv-userfields-portlet"),n.reloadPortletsByType(".sv-profileprogress-portlet"),b(".modal").modal("hide");else if(d.serverError){var a=b(".alert");a.show();a.find(".alert-title").text(f("error"));a.find(".alert-message").text(l(d.serverError));"wrong_password"===d.serverError&&(d=u.find("#password"),d.parents(".control-group").addClass("error"),d.focus())}else b.each(d.failedFields,function(a,d){var e=b("#"+
d);e.parents(".control-group").addClass("error");e.nextAll(".serverside-error").length||(e.nextAll(".help-block.error").remove(),e.after(b("<span/>").addClass("help-block help serverside-error").text(e.attr("data-errorMsg"))))})},error:function(){b(".alert").show()}})}else{var r=b("#password");r.length&&!e(r.get(0))&&(r.get(0).focus(),r.parents(".control-group").addClass("error"),b(".alert").show(),b(".alert").find(".alert-title").text(f("error")),b(".alert").find(".alert-message").text(l("wrong_password")));
b.each(p.fields,function(d,a){r=b("#"+a.id);"true"!==a.writeable||e(r.get(0))||(r.get(0).focus(),r.parents(".control-group").addClass("error"),r.nextAll(".serverside-error, .error").length||r.after(b("<span/>").addClass("help-block help error").text(r.attr("data-errorMsg"))))})}}}];q.showDialog({title:l("dialogTitle"),body:u,buttons:w,removeOnHide:!0,errorTitle:l("errorTitle"),errorMsg:l("errorMsg")})}})}}})();
(function(){var d=window.$svjq,m=window.sv.Events,n=window.LazyLoad,q,b=function(b){q?b.call():(n.css("/sitevision/ajax/jquery/plugins/videojs/video-js.css"),n.js("/sitevision/ajax/jquery/plugins/videojs/video.js",function(){q=!0;window.videojs.options.flash.swf="/sitevision/ajax/jquery/plugins/videojs/video-js.swf";b.call()}))},l=function(f){f=f||d(".sv-timeline-portlet, .sv-video-portlet, .sv-timelineentry-portlet");f.find("video:not(.sv-video-js-loaded)").each(function(){var e=d(this);b(function(){e.addClass("sv-video-js-loaded");
window.videojs(e.get(0),{width:"auto",height:"auto"})})})};m.on(m.types.updateVideoLinks,l);l()})();(function(){window.sv.WindowLocationUtil={setHashValue:function(d,m){window.location.hash="#"+d+"/"+m},getHashValue:function(d){var m=window.location.hash,n=2+d.length;if(0===m.indexOf("#"+d+"/")&&m.length>n)return m.substring(n)},clearHashValue:function(){window.location.hash=""},hasHashValue:function(){var d=window.location.hash;return 0===d.indexOf("#")&&1<d.indexOf("/")},reloadPage:function(){location.reload()}}})();
(function(){var d=window.$svjq,m=window.sv.i18n,n=window.sv,q=n.PortletUtil,b=n.Ajax;d(".sv-archive-portlet").on("click",".sv-create-article-entry",function(){var l=d(this),f=l.data("archive-id"),e=l.data("template-id"),l=l.parent(),n=d("<div>").addClass("sv-loading-icon").text(m.getText("portlet.archive.archive","creatingArticle"));l.empty().append(n);b.doPost({url:q.getEditApiUri({objectId:f,contextNodeId:f,modelHandler:"article"}),data:{template:e,portletType:"archive"},success:function(b){window.location.href=
"/edit/"+b.nodeId}});return!1})})();
(function(){var d=window.$svjq,m=window.sv.i18n,n=window.sv,q=n.PortletUtil,b=n.Ajax;d(".sv-blog-portlet").on("click",".sv-create-blog-entry",function(){var l=d(this),f=l.data("archive-id"),e=l.data("template-id"),l=l.parent(),n=d("<div>").addClass("sv-loading-icon").text(m.getText("portlet.blog.blog","creatingBlogEntry"));l.empty().append(n);b.doPost({url:q.getEditApiUri({objectId:f,contextNodeId:f,modelHandler:"article"}),data:{template:e,portletType:"blog"},success:function(b){window.location.href=
"/edit/"+b.nodeId}});return!1})})();
(function(){function d(d){var e=d.find("[data-comments2-entry]");m(d);if(0!==e.length){var f=b.getObjectId(d.attr("id")),k=e.data("js-namespace"),l=e.data("profilepageurl"),e=e.data("tagresultpageurl"),r=new D(n[k].comments||[],{id:f,portletId:f});w=n[k].maxCharacterCount;y=n[k].useCaptcha;new H({el:d,collection:r,commentTemplate:q.getTemplate(d,"comments2-comment"),portletId:f,profilePageURL:l,tagResultPageURL:e});f=d.find(".sv-comments2-comments");0<f.length&&(a(f,l),A(f,e));l=p.cookie("fullName");
null!==l&&0<l.length&&d.find("[data-fn-comments2-input-name]").val(l);d.find(".sv-comment-hidden").attr("title",v("hiddenComment"))}}function m(a){var e=b.getObjectId(a.attr("id"));a.off("click","[data-fn-comment2-toggle-close]");a.on("click","[data-fn-comment2-toggle-close]",function(b){b.preventDefault();b=q.getPortletUri(e,"toggleVisible");p.get(b,function(b){a.find(".sv-comments2-portlet-content").html(b);d(a)})});a.off("click","[data-fn-comment2-toggle-mutable]");a.on("click","[data-fn-comment2-toggle-mutable]",
function(b){b.preventDefault();b=q.getPortletUri(e,"toggleMutable");p.get(b,function(){a.find("[data-sv-comments2-closed-title]").hasClass("sv-hidden")?(a.find("[data-sv-comments2-closed-title]").removeClass("sv-hidden"),a.find(".sv-comments2-form").addClass("sv-hidden"),a.find("[data-sv-comments2-disallow-comments]").addClass("sv-hidden"),a.find("[data-sv-comments2-allow-comments]").removeClass("sv-hidden")):(a.find("[data-sv-comments2-closed-title]").addClass("sv-hidden"),a.find(".sv-comments2-form").removeClass("sv-hidden"),
a.find("[data-sv-comments2-disallow-comments]").removeClass("sv-hidden"),a.find("[data-sv-comments2-allow-comments]").addClass("sv-hidden"))})})}var n=window.sv,q=n.PortletUtil,b=n.ObjectUtil,l=n.Events,f=n.KeyUtil,e=f.KEY,p=window.$svjq,u=n.Ajax,k=window.SVBackbone,s=window._sv,r={},w,y,z={triggers:{"@":{source:q.getModelObjectUri(n.PageContext.pageId,"userIdentitySearch",n.PageContext.pageId),searchKey:"term",allowWhiteSpace:!0,maxWhiteSpace:2,parse:function(a){return a.hits}}},minLength:2,replacer:function(a){return a.trigger+
'{"value":"'+a.name+'","id":"'+a.id+'"}'}},v=function(a,b){var d;if(!b&&r[a])return r[a];d=n.i18n.getText("portlet.comments2.comments",a,b);b||(r[a]=d);return d},a=function(a,b){a.find("a[data-user-identity]").each(function(){var a=p(this);a.attr("href",b+"?identity="+a.data("user-identity"))})},A=function(a,b){a.find("a[data-social-tag-id]").each(function(){var a=p(this);a.attr("href",b+"?tag="+encodeURIComponent(a.data("social-tag-name")))})},x=k.Model.extend({defaults:{removeTitle:v("removeCommentTitle"),
editTitle:v("editCommentTitle")},url:function(){return this.collection?this.collection.url()+"&commentId="+this.get("id"):"?commentId="+this.get("id")}}),D=k.Collection.extend({model:x,initialize:function(a,b){this.options=b;this.bindServerEvents()},bindServerEvents:function(){var a=this;l.on("server-pagecomment-added-"+n.PageContext.pageId,function(b){a.add(b.content,{append:!0})})},url:function(){return q.getPortletResourceUri(this.options.portletId,"comment")+"&file="+this.options.id}}),F=k.View.extend({tagName:"li",
className:function(){return this.model.get("hidden")?"sv-comment2-comment sv-comment-hidden":"sv-comment2-comment"},events:{"click [data-fn-destroy-comment]":"showDestroyDialog","click [data-fn-edit-comment]":"editComment","click [data-fn-hide-comment]":"doHide","click [data-fn-show-comment]":"doHide"},initialize:function(){this.listenTo(this.model,"change:comment",this.updateComment,this);this.listenTo(this.model,"destroy",this.remove,this);this.listenTo(this.model,"change:hidden",this.hide,this)},
showDestroyDialog:function(){var a=this;n.DialogUtil.showConfirmDialog(v("removeCommentTitle"),v("removeCommentBody"),function(b){b&&a.model.destroy({wait:!0})});return!1},editComment:function(a){a.preventDefault();u.doGet({context:this,url:q.getPortletResourceUri(this.options.portletId,"comment")+"&commentId="+this.model.get("id")}).done(function(a){this.showEditComment(a.plainMessage,a.mentions)})},showEditComment:function(a,b){var d=this,e=this.model.get("id"),f=p("<div/>"),k=p('<span class="sv-float-right">'+
(w-a.length)+"</span>"),l=p("<textarea/>").attr("id","editComment").addClass("sv-comment-input sv-border-box").on("keyup",s.bind(function(a){a=w-a.currentTarget.value.length;0>a?(k.addClass("sv-character-limit-exceeded"),this.getSaveEditCommentButton().addClass("disabled").attr("disabled","disabled")):(k.removeClass("sv-character-limit-exceeded"),this.getSaveEditCommentButton().removeClass("disabled").removeAttr("disabled"));k.text(a)},this)).val(a);f.addClass("sv-comments2-portlet").append(l).append(k);
var m=[{text:v("save"),callback:p.proxy(function(){u.doPut({url:q.getPortletResourceUri(d.options.portletId,"comment")+"&commentId="+e,data:{comment:l.triggeredInput("getRichContent")},context:this}).done(function(a){this.model.set(a)})},this)}];n.DialogUtil.showDialog({title:v("editCommentTitle"),body:f,buttons:m,shownCallback:function(){l.triggeredInput(z).triggeredInput("setIds",b).elastic()}});return!1},getSaveEditCommentButton:function(){this.$saveEditButton||(this.$saveEditButton=p(".modal-footer button"));
return this.$saveEditButton},updateComment:function(a){a.get("hidden")&&!a.get("isAdmin")?a.collection.remove(a):(this.render(),l.trigger(l.types.updateLikables,this.$el),l.trigger(l.types.updateRelativeDates,this.$el))},doHide:function(a){a.preventDefault();this.model.set({hidden:!this.model.get("hidden")});this.model.save({},{url:q.getPortletResourceUri(this.model.collection.options.portletId,"toggleVisibleComment")+"&commentId="+this.model.id})},hide:function(){this.model.get("hidden")?(this.$el.addClass("sv-comment-hidden"),
this.$el.attr("title",v("hiddenComment")),this.$el.find("[data-fn-hide-comment]").addClass("sv-hidden"),this.$el.find("[data-fn-show-comment]").removeClass("sv-hidden"),this.$el.find(".sv-comments2-hidden-comment-text").removeClass("sv-hidden")):(this.$el.removeClass("sv-comment-hidden"),this.$el.removeAttr("title"),this.$el.find("[data-fn-hide-comment]").removeClass("sv-hidden"),this.$el.find("[data-fn-show-comment]").addClass("sv-hidden"),this.$el.find(".sv-comments2-hidden-comment-text").addClass("sv-hidden"))},
render:function(){this.$el.html(this.options.template(this.model.toJSON()));this.model.toJSON().hidden&&this.$el.attr("title",v("hiddenComment"));a(this.$el,this.options.profilePageURL);A(this.$el,this.options.tagResultPageURL);return this}}),H=k.View.extend({initialize:function(){this.$list=this.$el.find("[data-fn-comments2]");this.collection.on("add",this.addNewComment,this);this.collection.on("remove",this.removeComment,this);this.$el.find("[data-fn-comments2-input]").triggeredInput(z).elastic();
0<this.collection.length&&this.render()},render:function(){this.clearList();this.collection.each(function(a){this.appendOne(a)},this);l.trigger(l.types.updateRelativeDates,this.$el);l.trigger(l.types.updateLikables,this.$el)},clearList:function(){this.$list.empty()},appendOne:function(a){a=(new F({model:a,portletId:this.options.portletId,template:this.options.commentTemplate,profilePageURL:this.options.profilePageURL,tagResultPageURL:this.options.tagResultPageURL})).render().$el;var b=a.find(".sv-comments2-content").find(".sv-truncate-more"),
d;0<b.length&&(this.addShowMoreLink(b),d=!0);this.$list.append(a);d&&this.bindShowMoreEvents(a)},bindShowMoreEvents:function(a){var b=v("showMore"),d=v("showLess"),e=p(".sv-truncate-more-link",a),f=p(".sv-truncate-more",a),k=p(".sv-truncate-ellipsis",a);e.on("click",function(a){a.preventDefault();e.text()===b?(f.show(),e.text(d),k.css("display","none")):(f.hide(),e.text(b),k.css("display","inline"))})},addShowMoreLink:function(a){p('<span class="sv-truncate-ellipsis">...</span>').insertBefore(a);
p('<div><a href="#" class="sv-truncate-more-link">'+v("showMore")+"</a></div>").insertAfter(a);a.css("display","none")},addNewComment:function(a){void 0!==a.toJSON().author?this.appendOne(a):l.trigger(l.types.notifyUser,{type:"default",heading:v("moderatedHeading"),message:v("moderatedBody"),transient:!0});l.trigger(l.types.updateRelativeDates,this.$el);l.trigger(l.types.updateLikables,this.$el)},removeComment:function(a){this.render();a.get("hidden")&&l.trigger(l.types.notifyUser,{type:"default",
heading:v("moderatedHeading"),message:v("moderatedBody"),transient:!0})},getLoader:function(){this.$loader||(this.$loader=p('<img src="/sitevision/util/images/loading_16_grey.gif" />').css("vertical-align","middle").appendTo(this.$el.find("[data-fn-comment-input]").parent()));return this.$loader},events:{"focus [data-fn-comments2-input]":"expandTextfield","click [data-fn-comments2-input]":"expandTextfield","keyup [data-fn-comments2-input]":"countdownCharactersLeft","keyup [data-fn-comments2-input-name]":"countdownCharactersLeft",
"keydown [data-fn-comments2-input]":"checkKeyDown","submit [data-fn-comments2-form]":"postComment"},expandTextfield:function(a){p(a.currentTarget).addClass("sv-message-input-expanded");this.$el.find(".sv-submit-controls").show();this.countdownCharactersLeft(a)},shrinkTextfield:function(){this.$el.find(".sv-message-input-expanded").removeClass("sv-message-input-expanded");this.$el.find(".sv-submit-controls").hide()},getTextField:function(){this.$textField||(this.$textField=this.$el.find("[data-fn-comments2-input]"));
return this.$textField},countdownCharactersLeft:function(a){a=p(a.currentTarget);var b=a.val(),b=w-b.length,d=this.$el.find("[data-fn-comments2-input-size]");0>b?d.addClass("sv-character-limit-exceeded"):d.removeClass("sv-character-limit-exceeded");d.text(b);""!==a.val()&&0<=b&&!this.activeConnection?this.enableSubmitButton():this.disableSubmitButton()},checkKeyDown:function(a){if(f.getKeyCodeFromEvent(a)===e.RETURN&&a.ctrlKey)return this.getSubmitButton().focus(),this.$el.find("[data-fn-comments2-form]").submit(),
!1},postComment:function(a){var b=this,d,e,f,k;if(!a.isPropagationStopped()&&!a.isDefaultPrevented()){a.preventDefault();if(this.activeConnection)return!1;d=this.$el.find("[data-fn-comments2-input]");k=b.getNameField();a=d.val().length;if(1===k.length&&0===k.val().length)return l.trigger(l.types.notifyUser,{type:"default",heading:v("noNameHeading"),message:v("noNameBody"),transient:!0}),!1;if(0<a&&a<=w){if(y&&(e=(e=this.$el.find("#g-recaptcha-response"))&&e[0].value,!e))return this.$el.find("#sv-help-block-verify").show(),
!1;this.disableSubmitButton();this.activeConnection=!0;e=new x({comment:d.triggeredInput("getRichContent"),fullName:k.val(),useCaptcha:y,recaptchaResponse:e||""});a=b.$el.find("[data-sv-spam-marker]");0<a.length&&(e.attributes[a.attr("name")]=a.val());f=setTimeout(function(){b.getLoader().show()},400);this.collection.create(e,{wait:!0,success:function(){d.val("");b.activeConnection=!1;b.getLoader().hide();clearTimeout(f);p.cookie("fullName",k.val());y&&b.$el.find("#recaptcha-container").hide()},error:function(){b.activeConnection=
!1;b.getLoader().hide();clearTimeout(f);b.enableSubmitButton();l.trigger(l.types.notifyUser,{type:"error",heading:v("postFailedHeading"),message:v("postFailedBody"),transient:!0})}});this.shrinkTextfield()}else a>w&&l.trigger(l.types.notifyUser,{type:"default",heading:v("commentToLongHeading"),message:v("commentToLongBody"),transient:!0});return!1}},getSubmitButton:function(){this.$submitButton||(this.$submitButton=this.$el.find("[data-fn-comments2-submit]"));return this.$submitButton},getNameField:function(){this.$NameField||
(this.$NameField=this.$el.find("[data-fn-comments2-input-name]"));return this.$NameField},disableSubmitButton:function(){this.getSubmitButton().addClass("disabled").attr("disabled","disabled")},nameFieldOK:function(){var a=this.getNameField();return 0===a.length||a.val()?!0:!1},enableSubmitButton:function(){""!==this.getTextField().val()&&this.nameFieldOK()&&this.getSubmitButton().removeClass("disabled").removeAttr("disabled")}});p(".sv-comments2-portlet").each(function(){var a=p(this);d(a)})})();
(function(){function d(b){this.options=b;this.bindLinkListener()}var m=window.$svjq,n=window.sv,q=/^[A-Z0-9._%+\-]+@([A-Z0-9][.\-]?)+[A-Z0-9]+\.[A-Z]{2,6}$/i;d.prototype={bindLinkListener:function(){var b=this;this.options.$portlet.find("."+this.options.linkClass).on("click",function(){b.openDialog.call(b,this);return!1})},getDialogContainer:function(){this.$dialogContainer||(this.$dialogContainer=m("<div/>"));return this.$dialogContainer},showMessageDialog:function(b){this.$subDialogContainer?this.$subDialogContainer.html(b).svDialog("open"):
this.$subDialogContainer=m("<div/>").html(b).svDialog({open:!0,title:this.options.sendMessageTitle,buttons:[{text:this.options.closeButtonText,type:"primary",callback:m.proxy(function(){this.$subDialogContainer.svDialog("close")},this)}]})},validateForm:function(){var b=!0,d=this.getDialogContainer().find("form");m.each(this.options.requiredFields,m.proxy(function(e,f){var m=d.find("[name="+f+"]");this.validateField(m)||(b=!1)},this));if(this.options.attachmentField){var f=d.find("[name=attachment]");
this.checkAttachmentSize(f)||(b=!1)}return b},validateField:function(b){var d=b.is("[name=emailAddress]"),f=b.is("[name=attachment]");if(this.checkRequiredField(b)){if(d&&!this.checkEmailAddress(b))return this.appendErrorMessage(b,this.options.errorMessages.invalidEmail),!1;if(f&&!this.checkAttachmentSize(b))return this.appendErrorMessage(b,this.options.errorMessages.fileSizeExceeded),!1;this.removeValidationErrors(b);return!0}this.appendErrorMessage(b,this.options.errorMessages[b.attr("name")]);
return!1},checkEmailAddress:function(b){if(0===b.length)return!0;b=b.val();return""===m.trim(b)&&-1===m.inArray("emailAddress",this.options.requiredFields)||q.test(b)},checkAttachmentSize:function(b){return 0===b[0].files.length?!0:b[0].files[0].size<this.options.maxMailSize},checkRequiredField:function(b){var d=!1;return-1===m.inArray(b.attr("name"),this.options.requiredFields)?!0:d=b.is("[type=checkbox]")?b.is(":checked")||0<b.siblings("input[type=checkbox]").filter(":checked").length:!!m.trim(b.val())},
appendErrorMessage:function(b,d){b.siblings(".sv-contact2-error-message-container").remove();b.addClass("sv-contact2-warned");var f=m("<label/>",{"for":b.attr("id"),"class":this.options.errorFont}).html('<img alt="" style="border:none; width:16px; height:16px; vertical-align:middle" src="'+this.options.errorImageSrc+'"/> '+d);m('<div class="sv-contact2-error-message-container" />').append(f).appendTo(b.parent())},removeValidationErrors:function(b){(b?b.parent():this.getDialogContainer()).find(".sv-contact2-error-message-container").remove()},
handleSubmit:function(){var b=this.options.ajaxFormUrl,d;this.validateForm()&&(this.options.attachmentField?this.getDialogContainer().find("form").submit():(d=this.getDialogContainer().find("form").serialize(),m.post(b,d,m.proxy(function(b){this.closeDialog();this.showMessageDialog(b)},this))))},closeDialog:function(){this.getDialogContainer().svDialog("close")},buildDialogUrl:function(b){return this.options.ajaxSendBaseUrl+"&contactUserId="+b.substring(3).replace("_",".")},openDialog:function(b){var d=
this.getDialogContainer(),f=d.find(".sv-form-consent");if(this.dialogCreated)d.svDialog("setURL",this.buildDialogUrl(b.id)).svDialog("open"),f.length&&d.svDialog("disableSubmitButton");else{d.svDialog({open:!0,url:this.buildDialogUrl(b.id),title:this.options.sendMessageTitle,modal:this.options.useModalDialog,buttons:[{text:this.options.submitButtonText,type:"primary",callback:m.proxy(this.handleSubmit,this)},{text:this.options.cancelButtonText,type:"link",callback:m.proxy(this.closeDialog,this)}]});
var e=this;d.on("change","input, textarea",function(){e.validateField(m(this))});d.on("change","input[data-sv-form-consent-checkbox]",function(){m(this).is(":checked")?d.svDialog("enableSubmitButton"):d.svDialog("disableSubmitButton")});d.on("open:dialog.sv-dialog",function(){d.find(".sv-form-consent").length&&d.svDialog("disableSubmitButton")});d.on("keyup","input[type=text].sv-contact2-warned, textarea.sv-contact2-warned",function(){e.validateField(m(this))});this.dialogCreated=!0}}};m(".sv-contact2-portlet").each(function(){var b=
m(this),l=n.contact2&&n.contact2[this.id.substring(4)];l&&(l.$portlet=b,l=new d(l),b.data("sv-contact2-portlet",l))})})();
(function(){var d=window.$svjq,m={};d(".sv-has-error").each(function(){var m=d(this);m.on("change keyup",function(){m.removeClass("sv-has-error");m.off()})});var n=function(n){var b=n.val();n=m[n.attr("id")];b=n.initialSize-d.trim(b).length;0>b?n.$el.addClass("sv-textfield-limit-exceeded"):n.$el.removeClass("sv-textfield-limit-exceeded");n.$el.text(b)};d(".sv-form-textfield.sv-limit-characters").each(function(){var q=d(this),b=q.parent().find(".sv-textfield-input-size"),l=q.attr("id");m[l]={$el:b,
initialSize:b.text()};q.on("keyup",function(b){n(d(b.currentTarget))});q.val().length&&n(q)});d("form[data-sv-user-consent]").each(function(){var m=d(this),b=m.find("input[type=submit]:not(.sv-survey-next)");b.length&&(m=m.find("[data-sv-form-consent-checkbox]"),b.prop("disabled",!m.is(":checked")),m.on("change",function(){b.prop("disabled",!d(this).is(":checked"))}))})})();
(function(){function d(b,d,f,e,n,q){var k=window.hs,s=m.i18n.getLanguage();if("de"===s||"no"===s||"sv"===s)k.lang=k.lang[s];k.numberingClass=b;b={interval:d,repeat:!0,useControls:!n,fixedControls:"fit"};n||(b.overlayOptions={position:"bottom right",hideOnMouseOut:e,offsetY:f,offsetX:-3});q||(b.thumbstrip={position:"above",mode:"horizontal",relativeTo:"expander"});k.addSlideshow(b)}var m=window.sv,n=window.$svjq,q=window.LazyLoad;m.ImageAlbumUtil={createSlideShow:function(b,l,f,e,m,u){window.hs?d(b,
l,f,e,m,u):(q.css("/sitevision/ajax/highslide/highslide.css"),n.getScript("/sitevision/ajax/highslide/highslide_mod.js",function(){d(b,l,f,e,m,u)}))}}})();
(function(d,m){d.sv=d.sv||{};d.sv.responsiveTables=d.sv.responsiveTables||{};d.sv.responsiveTables.config=d.sv.responsiveTables.config||{};d.sv.responsiveTables.classNames={};d.sv.responsiveTables.selectors={};m.each([["groupName",""],["scroll","--scroll"],["fixedFirst","--fixedFirst"],["stackGroupName","--stacked"],["stackTable","--stackTable"],["stackColumns","--stackColumns"]],function(m,q){d.sv.responsiveTables.classNames[q[0]]="sv-responsiveTable"+q[1];d.sv.responsiveTables.selectors[q[0]]=".sv-responsiveTable"+
q[1]});d.sv.responsiveTables.config=m.extend({},{breakpoint:"767px",fixedFirstWidth:"35%",divClassTmpl:'<div class="<%= classNames %>" />',divStyleTmpl:'<div class="<%= classNames %>" style="<%= styleAttr %>" />',tblTmpl:'<table class="<%= classNames %>"><tbody></tbody></table>',tblThRowTmpl:'<tr class="<%= trClassNames %>"><th class="<%= thClassNames %>" colspan="<%= colSpan %>"><%= content %></th></tr>',tblTrRowTmpl:'<tr class="<%= trClassNames %>"><td class="<%= groupName %>__key"><%= keyContent %></td><td class="<%= groupName %>__value <%= cellClassName %>"><%= valueContent %></td></tr>'},
d.sv.responsiveTables.config)})(window,window.$svjq);
(function(d,m,n,q,b,l){var f=q.classNames,e=q.selectors,p=q.config;(function(){n.svRespTables||(n.svRespTables={});n.svRespTables.scroll=function(d){this.init=function(){n(d).removeClass(f.groupName).wrap(b(p.divClassTmpl,{classNames:f.groupName}))};this.init()};n.fn.svRespTables_scroll=function(){return this.each(function(){new n.svRespTables.scroll(this)})};n.svRespTables.fixedFirst=function(d){var k=this,m=f.groupName+" "+f.fixedFirst,r=q.mql,w=!1;k.$el=n(d);k.$el.data("svRespTables.fixedFirst",
k);k.init=function(){k.$el.removeClass(m).wrap(b(p.divClassTmpl,{classNames:m}))};k.splitTable=function(){k.$copy=k.$el.clone();k.$copy.css("width","100%").find("td:not(:first-child), th:not(:first-child)").hide().end().find("caption").html("&nbsp;");k.$el.closest(".sv-responsiveTable--fixedFirst").append(k.$copy);k.$copy.wrap(b(p.divStyleTmpl,{classNames:f.fixedFirst+"__pinned",styleAttr:"width: "+p.fixedFirstWidth}));k.$el.wrap(b(p.divStyleTmpl,{classNames:f.fixedFirst+"__scrollable",styleAttr:"margin-left: "+
p.fixedFirstWidth}));k.setCellHeights()};k.unSplitTable=function(){k.$el.closest(e.fixedFirst).find(e.fixedFirst+"__pinned").remove();k.$el.unwrap();k.$copy=l;k.unSetCellHeights()};k.setCellHeights=function(){var b=k.$el.find("tr"),d=k.$copy.find("tr"),e=[];b.each(function(a,b){n(b).find("th, td").each(function(){var b=n(this).outerHeight(!0);e[a]=e[a]||0;b>e[a]&&(e[a]=b)})});d.each(function(a,d){n(d).height(e[a]);b.eq(a).height(e[a])})};k.unSetCellHeights=function(){k.$el.find("tr").each(function(b,
d){d.style.height="auto"})};k.updateTables=function(){!r.matches&&w?(w=!1,k.unSplitTable()):r.matches&&!w&&(w=!0,k.splitTable())};r.addListener(k.updateTables);n(k.updateTables);k.init()};n.fn.svRespTables_fixedFirst=function(){return this.each(function(){new n.svRespTables.fixedFirst(this)})};n.svRespTables.stackTable=function(d){var e=this,m=q.mql;e.$el=n(d);e.$el.data("svRespTables.stackTable",e);e.init=function(){var d="",l,q;m.removeListener(e.init);e.$copy=n(b(p.tblTmpl,{classNames:e.$el.prop("class")+
" "+f.stackGroupName+"__smallOnly"}));e.$el.addClass(f.stackGroupName+"__largeOnly");l=e.$el.find("caption").clone();q=e.$el.find("tr").eq(0);e.$el.find("tr").each(function(e,k){var a=n(k),m="",l="",s,u=a.prop("class");0===e?d+=b(p.tblThRowTmpl,{trClassNames:u,thClassNames:f.stackGroupName+"__headRow "+f.stackGroupName+"__headRow--main",colSpan:2,content:a.find("th, td").eq(0).html()}):(a.find("td, th").each(function(a,d){var e=n(d);n.trim(e.html())&&(0===a?m+=b(p.tblThRowTmpl,{trClassNames:u,thClassNames:f.stackGroupName+
"__headRow",colSpan:2,content:e.html()}):(s=n.trim(q.find("td,th").eq(a).html()),l+=b(p.tblTrRowTmpl,{trClassNames:u,groupName:f.stackGroupName,keyContent:s?s:"",cellClassName:e.prop("class"),valueContent:e.html()})))}),d+=m+l)});e.$copy.find("tbody").before(l).html(d);e.$el.before(e.$copy)};m.matches?e.init():m.addListener(e.init)};n.fn.svRespTables_stackTable=function(){return this.each(function(){new n.svRespTables.stackTable(this)})};n.svRespTables.stackColumns=function(d){var e=this,m=q.mql;
e.$el=n(d);e.$el.data("svRespTables.stackColumns",e);e.init=function(){function d(b,a){var e=n(a),k=n("<tr></tr>"),m,l,p;0===b&&k.addClass(f.stackGroupName+"__headRow "+f.stackGroupName+"__headRow--main");m=e.find("td, th").eq(0).clone().addClass(f.stackGroupName+"__key");l=q;e.find("*[colspan]").length&&(p=0,e.find("td, th").each(function(a,b){var d=n(b).attr("colspan");if(p>q)return!1;d?(d=parseInt(d,10),l-=d-1,p+d>q&&(l+=p+d-q-1),p+=d):p++}));e=e.find("td, th").eq(l).clone();e.addClass(f.stackGroupName+
"__value").removeAttr("colspan");k.append(m,e);u.append(k)}var l=e.$el.find("tr").eq(0).find("td, th").length,q=1,u;m.removeListener(e.init);if(!(3>l)){e.$copy=n(b(p.tblTmpl,{classNames:e.$el.prop("class")+" "+f.stackGroupName+"__smallOnly"}));e.$el.addClass(f.stackGroupName+"__largeOnly");e.$el.find("caption").length&&e.$copy.find("tbody").before(e.$el.find("caption").clone());for(u=n("<tbody />");q<l;)e.$el.find("tr").each(d),++q;e.$copy.find("tbody").append(u.html());e.$el.before(e.$copy)}};m.matches?
e.init():m.addListener(e.init)};n.fn.svRespTables_stackColumns=function(){return this.each(function(){new n.svRespTables.stackColumns(this)})}})()})(window,window.document,window.$svjq,window.sv.responsiveTables,window.sv.TemplateUtil.template);
(function(d,m,n,q,b){var l,f=b.selectors;b.init=function(){var d=n(m.getElementsByTagName("table")).filter(f.groupName);0<d.length&&(b.appendCSS(),d.filter(f.scroll).svRespTables_scroll().end().filter(f.fixedFirst).svRespTables_fixedFirst().end().filter(f.stackTable).svRespTables_stackTable().end().filter(f.stackColumns).svRespTables_stackColumns())};n(function(){l=n(m.body);d.matchMedia&&l.hasClass("sv-responsive")&&!l.hasClass("sv-editing-mode")&&(b.mql=window.matchMedia("(max-width: "+b.config.breakpoint+
")"),b.init())})})(window,window.document,window.$svjq,window.sv,window.sv.responsiveTables);
(function(d,m){var n,q;function b(b){var d=document.createElement("style");d.appendChild(document.createTextNode(""));document.head.appendChild(d);b&&d.setAttribute("media","(max-width: "+b+")");return d.sheet}n=["div.sv-responsiveTable { overflow: auto; max-width: 100%; }","div.sv-responsiveTable * { white-space: nowrap !important; }","div.sv-responsiveTable--fixedFirst { position: relative; margin-bottom: 20px; overflow: hidden; border-right: 1px solid #ccc; }","div.sv-responsiveTable--fixedFirst table { margin-bottom: 0; overflow: visible; max-width: none; }",
"div.sv-responsiveTable--fixedFirst td, div.sv-responsiveTable--fixedFirst th { position: relative; overflow: hidden; }","div.sv-responsiveTable--fixedFirst__scrollable th:first-child, div.sv-responsiveTable--fixedFirst__scrollable td:first-child { display: none; }","div.sv-responsiveTable--fixedFirst__pinned { position: absolute; left: 0; top: 0; background: #fff; overflow: hidden; overflow-x: scroll; border-right: 1px solid #ccc; border-left: 1px solid #ccc; }","div.sv-responsiveTable--fixedFirst__pinned table { border-right: none; border-left: none; width: 100%; }",
"div.sv-responsiveTable--fixedFirst__pinned td:first-child, div.sv-responsiveTable--fixedFirst__pinned th:first-child { width: 100%; }","div.sv-responsiveTable--fixedFirst__scrollable { overflow: scroll; overflow-y: hidden; }",".sv-responsiveTable--stacked { overflow: visible; }",".sv-responsiveTable--stacked__largeOnly { display: none; }",".sv-responsiveTable--stacked__smallOnly { display: table; }"];q=[".sv-responsiveTable--stacked__largeOnly { display: table; }",".sv-responsiveTable--stacked__smallOnly { display: none; }"];
m.appendCSS=function(){var l=b(),f=b(m.config.breakpoint);d.each(q,function(b,d){l.insertRule(d,b)});d.each(n,function(b,d){f.insertRule(d,b)})}})(window.$svjq,window.sv.responsiveTables);
(function(){var d=window.$svjq,m=window.sv,n=window._sv,q,b=function(b){var f=b.portletId,e=m.ObjectUtil.getHtmlId(f),p=b.inputField,u=b.resultDiv,k=-1,s=-1,r=function(){u.hide()};d("body").bind("click",r);var w=function(a,b){if(-1<a){var d=b.find(".sv-searchform2-search-list-column"+a);if(1===d.length)return d}},y=function(a,b){if(-1<a&&a<b.children().length)return d(b.children()[a])},z=function(a,b,d){a=w(a,d);if(void 0!==a)return y(b,a)},v=function(a){var b=0,d=w(0,a),e=w(1,a);a=w(2,a);void 0!==
d&&b++;void 0!==e&&b++;void 0!==a&&b++;return b},a=function(a){a.children().removeClass("active").attr("aria-selected",!1);p.attr("aria-activedescendant","")},A=function(a){a.addClass("active").attr("aria-selected",!0);p.attr("aria-activedescendant",a.attr("id"))};p.keydown(function(b){b=m.KeyUtil.getKeyCodeFromEvent(b);var d=w(0,u),e=w(1,u),f=w(2,u);void 0!==d&&void 0!==e&&(b===m.KeyUtil.KEY.RIGHT&&0===s?(s=1,k=-1,a(d),a(f),b=m.KeyUtil.KEY.DOWN):b===m.KeyUtil.KEY.LEFT&&1===s?(s=0,k=-1,a(e),a(f),
b=m.KeyUtil.KEY.DOWN):b===m.KeyUtil.KEY.RIGHT&&1===s?(s=2,k=-1,a(d),a(e),b=m.KeyUtil.KEY.DOWN):b===m.KeyUtil.KEY.LEFT&&2===s&&(s=1,k=-1,a(d),a(f),b=m.KeyUtil.KEY.DOWN));if(b===m.KeyUtil.KEY.DOWN||b===m.KeyUtil.KEY.UP){var l;0===s&&void 0!==d?l=d:1===s&&void 0!==e?l=e:2===s&&void 0!==f?l=f:-1===s&&(f=u.hasClass("sv-searchform2-result-container-alignment-left")?"left":"right","left"===f?void 0!==d&&(s=0,l=d):void 0!==e?(s=1,l=e):void 0!==d&&(s=0,l=d));b===m.KeyUtil.KEY.DOWN&&void 0!==l&&k+1<l.children().length?
(b=y(k+1,l),k++,a(l),A(b)):b===m.KeyUtil.KEY.UP&&void 0!==l&&-1<k&&(k--,a(l),0<=k?(l=y(k,l),A(l)):s=-1);return!1}}).keyup(function(b){b=m.KeyUtil.getKeyCodeFromEvent(b);b===m.KeyUtil.KEY.ESC?r():b===m.KeyUtil.KEY.RETURN?(b=z(s,k,u),void 0!==b?location.href=b.find("a").attr("href"):1===v(u)&&(b=w(0,u).find(".sv-searchform2-more-hits"),1===b.length&&(location.href=b.find("a").attr("href")))):m.KeyUtil.isNonTextModifiableKeyCode(b)||(void 0!==q&&clearTimeout(q),q=setTimeout(function(){var b=p.val();
s=k=-1;if(""===b||2>b.length)u.css("display","none");else{var l=m.PortletUtil.getPortletResourceUri(f,"query");d.ajax({url:l,data:{term:b}}).fail(function(a){u.html('<div class="sv-searchform2-message">'+m.i18n.getText("portlet.search.searchform2.searchform2","searchFailed",a.status)+"</div>")}).done(function(f){if(b===f.term){var l=f.facets;u.empty();u.css("width","auto");if(0===l.length)l=n.template('<div class="sv-searchform2-message">   <<%= noHitsTag %> class="<%= noHitsClass %>"><%= noHitsText %></<%= noHitsTag %>></div>'),
u.append(d(l(f)));else{var r=document.documentElement.clientWidth,q=f.width/2,w=f.contentColumns,v=q*l.length,y=!1,x=!1,z="";v>r&&(300<r?(q=r/2,v=q*l.length):v=q>r?q=r:q);for(r=0;r<l.length;r++){var C=l[r],c;"content"===C.type?(y=!0,c='<div class="sv-border-box sv-searchform2-facet-column'+r+'" style="width: '+q+'px">   <ul role="listbox" id="'+e+'_content_results" class="sv-defaultlist sv-user-search-list sv-searchform2-search-list sv-searchform2-search-list-column'+r+'">      <% _.each(hits, function(hit, index){ %>         <li aria-selected="false" role="option" id="'+
e+'_content_<%= index %>" class="sv-searchform2-search-hit sv-wrap-words"><a class="sv-vamiddle <%= contentTagClass %>" href="<%= hit.URL %>" onclick="<%= hit.onClick %>"><%= hit.name %></a><% if (typeof(hit.iconURL) !== \'undefined\') { %><img alt="<%= hit.iconDescription %>" class="sv-noborder-vamiddle" src="<%= hit.iconURL %>" style="margin-left: 3px;"><% } %></li>      <% }); %>      <% if (showDetails) { %>         <li id="'+e+'_content_more" aria-selected="false" role="option" class="sv-clearfix sv-searchform2-search-hit sv-searchform2-more-hits" role="option"><<%= textTag %> class="<%= textTagClass %>"><a href="<%= showDetailsURL %>"><%= showDetailsText %></a></<%= textTag %>></li>      <% } %>   </ul></div>'):
"ugc"===C.type?(y=!0,c='<div class="sv-border-box sv-searchform2-facet-column'+r+'" style="width: '+q+'px">   <ul role="listbox" id="'+e+'_ugc_results" class="sv-defaultlist sv-user-search-list sv-searchform2-search-list sv-searchform2-search-list-column'+r+'">      <% _.each(hits, function(hit, index){ %>         <li aria-selected="false" role="option" id="'+e+'_ugc_<%= index %>" class="sv-clearfix sv-searchform2-search-hit sv-wrap-words">            <img class="sv-buddy-icon sv-searchform2-user-img" src="<%= hit.iconURL %>" />            <% if (hit.isContact) { %><div style="float:right"><i class="halflings-icon ok"></i></div><% } %>            <div class="sv-searchform2-user-container">               <<%= userBlockTag %> class="sv-searchform2-user-name <%= userTagClass %>"><a href="<%= hit.entryURL %>" onclick="<%= hit.onClick %>"><%= hit.entryText %></a></<%= userBlockTag %>>               <% if (typeof(hit.userfields) !== \'undefined\') { %>                  <ul class="sv-searchform2-userfield-list">                     <% _.each(hit.userfields, function(userfield){ %>                        <li class="<%= textTagClass %> sv-wrap-words"><%= userfield.value %></li>                     <% }); %>                  </ul>               <% } %>            </div>         </li>      <% }); %>      <% if (showDetails) { %>         <li id="'+
e+'_ugc_more" aria-selected="false" role="option" class="sv-clearfix sv-searchform2-search-hit sv-searchform2-more-hits"><<%= textTag %> class="<%= textTagClass %>"><a href="<%= showDetailsURL %>"><%= showDetailsText %></a></<%= textTag %>></li>      <% } %>   </ul></div>'):"users"===C.type?(c='<div class="sv-border-box sv-searchform2-content-container">   <<%= facetTag %> class="sv-searchform2-content-header <%= facetTagClass %>"><%- name %></<%= facetTag %>>   <div class="sv-border-box sv-searchform2-facet-column'+
r+'" style="width: '+q+'px">      <ul role="listbox" id="'+e+'_user_results" class="sv-defaultlist sv-user-search-list sv-searchform2-search-list sv-searchform2-search-list-column'+r+'">         <% _.each(hits, function(hit, index){ %>            <li aria-selected="false" role="option" id="'+e+'_user_<%= index %>" class="sv-clearfix sv-searchform2-search-hit" >               <img class="sv-buddy-icon sv-searchform2-user-img" src="<%= hit.iconURL %>" />               <% if (hit.isContact) { %><div style="float:right"><i class="halflings-icon ok"></i></div><% } %>               <div class="sv-searchform2-user-container">                  <<%= userBlockTag %> class="sv-searchform2-user-name <%= userTagClass %>"><a href="<%= hit.profileURL %>" onclick="<%= hit.onClick %>"><%= hit.name %></a></<%= userBlockTag %>>                  <% if (typeof(hit.userfields) !== \'undefined\') { %>                     <ul class="sv-searchform2-userfield-list">                        <% _.each(hit.userfields, function(userfield){ %>                           <li class="<%= textTagClass %> sv-wrap-words"><%= userfield.value %></li>                        <% }); %>                     </ul>                  <% } %>               </div>            </li>         <% }); %>         <% if (showDetails) { %>            <li id="'+
e+'_user_more" aria-selected="false" role="option" class="sv-clearfix sv-searchform2-search-hit sv-searchform2-more-hits"><<%= textTag %> class="<%= textTagClass %>"><a href="<%= showDetailsURL %>"><%= showDetailsText %></a></<%= textTag %>></li>         <% } %>      </ul>   </div></div>',y=!1):(c="",m.Log.error("Skipping unsupported facet type "+C.type));u.css("width",v);y?(x||(c='<div class="sv-border-box sv-searchform2-content-container" style="width: '+q*w+'px">   <<%= facetTag %> class="sv-searchform2-content-header <%= facetTagClass %>"><%- name %></<%= facetTag %>>'+
c),x=!0):x&&(c="</div>"+c);c=n.template(c);z+=c(C)}u.append(d(z));var g=u.find("ul.sv-user-search-list");g.find("li.sv-searchform2-search-hit").mouseenter(function(){var b=d(this),c=b.parent();s=c.hasClass("sv-searchform2-search-list-column0")?0:c.hasClass("sv-searchform2-search-list-column1")?1:c.hasClass("sv-searchform2-search-list-column2")?2:-1;k=b.index();a(g);A(b)}).mouseleave(function(){k=s=-1;d(this).removeClass("active").attr("aria-selected",!1);p.attr("aria-activedescendant","")}).click(function(a){d(a.target).is("a")||
(a=d(this),location.href=a.find("a").attr("href"))})}l=f.facetAlignment+" top";f=f.facetAlignment+" bottom";p.attr("aria-activedescendant","");u.attr("aria-expanded",!0);u.show();u.position({my:l,at:f,of:p,offset:"0 1",collision:"none"})}})}},200));return!1})};d(".sv-searchform2-portlet").each(function(){var l=d(this),f=m.ObjectUtil.getObjectId(l.attr("id")),e=l.find(".sv-searchform2-result-container"),l=l.find(".sv-searchform2-input");l.attr("autocomplete","off");b({portletId:f,inputField:l,resultDiv:e})})})();
(function(){var d=window.$svjq,m=window.sv,n=m.ObjectUtil,q=m.PortletUtil,b=window.SVBackbone,m=b.Model.extend({getViewUrl:function(){return this.get("url")},isFolder:function(){return this.get("isFolder")}}),l=b.Collection.extend({model:m,initialize:function(b,d){this.portletId=d.portletId;this.currentFolderProps=d.currentFolderProps},url:function(){return q.getPortletResourceUri(this.portletId,"files")},setCurrentFolderProps:function(b){this.currentFolderProps=b},getCurrentFolderProps:function(){return this.currentFolderProps},
parse:function(b){this.setCurrentFolderProps(b.currentFolderProps);return b.items}}),f=b.View.extend({tagName:"tr",events:{"click [data-fetch-item]":"fetchItem"},initialize:function(){this.template=this.options.template;this.model.set("fontClass",this.model.isFolder()?this.options.folderFontClass:this.options.fileFontClass);this.portletView=this.options.portletView},render:function(){this.$el.html(this.template(this.model.toJSON(),this.model));return this},fetchItem:function(b){this.model.isFolder()&&
(b.preventDefault(),this.portletView.fetchFolder(this.model))}}),e=b.View.extend({initialize:function(){this.itemTemplate=this.options.itemTemplate;this.fileFontClass=this.options.fileFontClass;this.folderFontClass=this.options.folderFontClass;this.portletView=null},render:function(){this.clearTable();this.collection.each(function(b){this.appendOne(b)},this)},appendOne:function(b){b=new f({model:b,template:this.itemTemplate,portletView:this.portletView,fileFontClass:this.fileFontClass,folderFontClass:this.folderFontClass});
this.$el.append(b.render().el)},clearTable:function(){this.$el.empty()}}),p=m.extend({isFolder:function(){return!0}}),u=b.View.extend({tagName:"li",events:{"click [data-fetch-folder]":"fetchFolder"},initialize:function(){this.template=this.options.template;this.portletView=this.options.portletView;this.model.set("isActive",this.options.isActive)},render:function(){this.$el.html(this.template(this.model.toJSON(),this.model));return this},fetchFolder:function(b){b.preventDefault();this.portletView.fetchFolder(this.model)}}),
k=b.View.extend({initialize:function(){this.breadcrumbTemplate=this.options.breadcrumbTemplate;this.portletView=null},render:function(){this.clearList();this.collection.each(function(b,d){this.appendOne(b,d===this.collection.length-1)},this)},appendOne:function(b,d){var e=new u({model:b,template:this.breadcrumbTemplate,portletView:this.portletView,isActive:d});this.$el.append(e.render().el)},clearList:function(){this.$el.empty()}}),s=b.View.extend({initialize:function(){this.breadcrumbCollectionView=
this.options.breadcrumbCollectionView;this.breadcrumbCollection=this.breadcrumbCollectionView.collection;this.itemCollectionView=this.options.itemCollectionView;this.itemCollection=this.itemCollectionView.collection;this.breadcrumbCollectionView.portletView=this;this.itemCollectionView.portletView=this},render:function(){this.breadcrumbCollectionView.render();this.itemCollectionView.render()},fetchFolder:function(b){var d=this.itemCollection.getCurrentFolderProps();this.itemCollection.fetch({data:{sharePointFolderId:b.id,
trail:d.trail,trailTime:d.trailTime},context:this}).done(function(d){d.unauthorized?window.location.href=b.getViewUrl():(this.breadcrumbCollection.reset(d.breadcrumbs),this.render())})}});d(".sv-sharepointfile-portlet").each(function(){var f=d(this),m=n.getObjectId(f.attr("id")),u=f.find(".sv-sharepointfile-root"),z=u.data("js-namespace"),v=window.sv[z]||[];if(0!==v.length){var a=u.find(".sv-sharepointfile-breadcrumbs"),u=u.find(".sv-sharepointfile-files tbody"),z=u.data("file-font-class"),A=u.data("folder-font-class"),
x=v.items,D=v.currentFolderProps,F=v.breadcrumbs,v=q.getTemplate(f,"sharepointitem"),f=q.getTemplate(f,"sharepointbreadcrumb"),F=new b.Collection(F,{model:p}),a=new k({el:a,collection:F,breadcrumbTemplate:f}),m=new l(x,{portletId:m,currentFolderProps:D}),m=new e({el:u,collection:m,breadcrumbCollectionView:a,fileFontClass:z,folderFontClass:A,itemTemplate:v});(new s({breadcrumbCollectionView:a,itemCollectionView:m})).render()}})})();
(function(){var d=window.$svjq,m=window.sv;d(".sv-sharepointfile-portlet, .sv-sharepointsearchfilelist-portlet").each(function(){var n=d(this),q=n.find(".sv-sharepoint-login-modal");q.svDialog({title:m.i18n.getText("portlet.sharepoint.sharepointfile","connectToSharePoint"),open:!1,modal:!0,buttons:[{text:m.i18n.getText("portlet.sharepoint.sharepointfile","loginButton"),type:"primary",callback:function(b){b.preventDefault();q.find("form").submit()}},{text:m.i18n.getText("common","cancel"),type:"link",
callback:function(){q.svDialog("close")}}]});n.find(".sv-sharepoint-modal-button").click(function(){q.svDialog("open")})})})();
(function(){function d(){p&&0!==p.length||(p=l("<div/>"));return p}function m(b){b.preventDefault();b=d().find("form");l.post(b.attr("action"),b.serialize(),function(b){n();-1!==b.indexOf('http-equiv="Refresh"')?window.location.href=l("input[name=redirectURL]").attr("value"):0<l(b).find("div#error-messages").length?p=l("<div/>").html(b).svDialog({open:!0,title:l("input[name=windowTitle]").attr("value"),buttons:[{text:l("input[name=buttonText]").attr("value"),type:"primary",callback:m},{text:l("input[name=closeButtonText]").attr("value"),
type:"link",callback:n}]}):(p=d(),u?u.html(b).svDialog("open"):u=l("<div/>").html(b).svDialog({open:!0,title:l("input[name=windowTitle]").attr("value"),buttons:[{text:l("input[name=closeButtonText]").attr("value"),type:"primary",callback:q}]}))})}function n(){p.svDialog("remove")}function q(){u.svDialog("close")}function b(b){b=l("#"+b);p=d();b.on("click",function(b){b.preventDefault();p.svDialog({open:!0,url:this.href,title:l("input[name=windowTitle]").attr("value"),modal:!0,buttons:[{text:l("input[name=buttonText]").attr("value"),
type:"primary",callback:m},{text:l("input[name=closeButtonText]").attr("value"),type:"link",callback:n}]})})}var l=window.$svjq,f=window.sv,e,p,u;if(f.tellfriend2&&f.tellfriend2.length)for(e=0;e<f.tellfriend2.length;e+=1)b(f.tellfriend2[e])})();
