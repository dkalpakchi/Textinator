{% extends "admin/base_site.html" %}

<!-- LOADING -->
{% load static i18n fb_tags fb_versions fb_compat %}

<!-- STYLESHEETS -->
{% block extrastyle %}
  {{ block.super }}
  <link rel="stylesheet" type="text/css" href="{% static "admin/css/forms.css" %}" />
{% endblock %}

<!-- JAVASCRIPTS -->
{% block extrahead %}
  {{ block.super }}
  <script type="text/javascript" src="{% static_jquery %}"></script>
  <script type="text/javascript" src="{% static "admin/js/jquery.init.js" %}"></script>
  <script type="text/javascript">
  (function($) {
    $(document).ready(function() {
      // remove edit module if no actions are given
      if ($("select#id_custom_action").find("option").length <= 1) {
        $("fieldset#fieldset_edit").hide();
      }
    });
  })(django.jQuery);
  </script>
{% endblock %}

<!-- COLTYPE/BODYCLASS -->
{% block bodyclass %}change-form filebrowser{% if query.pop %} popup{% endif %}{% endblock %}
{% block coltype %}colM{% endblock %}

<!-- BREADCRBUMBS -->
{% block breadcrumbs %}{% include "filebrowser/include/breadcrumbs.html" %}{% endblock %}

<!-- CONTENT -->
{% block content %}
  <div id="content-main">
    <!-- POP-UP BREADCRUMBS -->
    {% if query.pop %}
      {% include "filebrowser/include/breadcrumbs.html" %}
    {% endif %}
    <form action="{% query_string "" "filter_date,filter_type,q,p" %}" method="post">{% csrf_token %}
      <div>
        {% if form.errors %}<p class="errornote">{% trans 'Please correct the following errors.' %}</p>{% endif %}
        <fieldset class="module aligned">
          <div class="form-row field-{{ form.name.name }}{% if form.name.errors %} errors{% endif %}">
            {% if form.name.errors %}{{ form.name.errors }}{% endif %}
            <div>
              <label class="required" for="id_name">{{ form.name.label }}</label>
              {{ form.name }}
              {% if form.name.help_text %}<p class="help">{{ form.name.help_text|safe }}</p>{% endif %}
            </div>
          </div>
        </fieldset>
        <fieldset class="card card-info card-outline" id="fieldset_edit">
          <div class="card-header">
            <h4>{% trans "Edit" %}</h4>
          </div>
          <div class="card-body">
            {% if form.custom_action.errors %}
              <div class="form-row errors">
                {{ form.custom_action.errors }}
              </div>
            {% endif %}
            <table class="table table-borderless" style="font-size: 13px;">
              <tbody>
                <tr>
                  <td><label class="required" for="id_custom_action">{{ form.custom_action.label }}</label></td>
                  <td>
                    {{ form.custom_action }}
                    {% if form.custom_action.help_text %}<p class="help">{{ form.custom_action.help_text|safe }}</p>{% endif %}
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </fieldset>
        {% if fileobject.filetype == "Folder" %}
          <fieldset class="card card-info card-outline">
            <div class="card-header">
              <h4>{% trans "Folder Information" %}</h4>
            </div>
            <div class="card-body">
              <table class="table table-borderless" style="font-size: 13px;">
                <tbody>
                  <tr>
                    <td><label>{% trans "Date" %}</label></td>
                    <td>
                      {{ fileobject.datetime|date:"N j, Y" }}
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </fieldset>
        {% endif %}
        {% if fileobject.filetype != "Folder" %}
          <fieldset class="card card-info card-outline">
            <div class="card-header">
              <h4>{% trans "File Information" %}</h4>
            </div>
            <div class="card-body">
              <table class="table table-borderless" style="font-size: 13px;">
                <tbody>
                  <tr>
                    <td><label>{% trans "URL" %}</label></td>
                    <td>
                      <a href="{{ fileobject.url }}">{{ fileobject.url }}</a>
                    </td>
                  </tr>
                  <tr>
                    <td><label>{% trans "Filesize" %}</label></td>
                    <td>
                      {{ fileobject.filesize|filesizeformat }}
                    </td>
                  </tr>
                  <tr>
                    <td><label>{% trans "Date" %}</label></td>
                    <td>
                      {{ fileobject.datetime|date:"N j, Y" }}
                    </td>
                  </tr>
                  {% if fileobject.filetype == "Image" %}
                    <tr>
                      <td><label>{% trans "Size" %}</label></td>
                      <td>
                        {{ fileobject.width }} x {{ fileobject.height }} px
                      </td>
                    </tr>
                  {% endif %}
                </tbody>
              </table>
            </div>
          </fieldset>
        {% endif %}
        {% if fileobject.filetype == "Image" %}
          <fieldset class="card card-info card-outline">
            <div class="card-header">
              <h4>{% trans "Image Versions" %}</h4>
            </div>
            <div class="card-body">
              <table class="table table-borderless" style="font-size: 13px;">
                <tbody>
                  {% if settings_var.ADMIN_THUMBNAIL %}
                    <tr>
                      <td><label>{% trans "Thumbnail" %}</label></td>
                      <td>
                        <img src="{% version fileobject.path settings_var.ADMIN_THUMBNAIL %}" title="{% trans 'View Image' %}" />
                      </td>
                    </tr>
                  {% endif %}
                  {% if settings_var.ADMIN_VERSIONS %}
                    {% for version in settings_var.ADMIN_VERSIONS %}
                      {% version fileobject version as image_version %}
                      {% version_setting version %}
                      <tr>
                        <td><label>{{ version_setting.verbose_name }}</label></td>
                        <td>
                          <img src="{{ image_version.url }}" />
                        </td>
                      </tr>
                    {% endfor %}
                  {% endif %}
                </tbody>
              </table>
            </div>
          </fieldset>
        {% endif %}
        <div class="card card-info card-outline">
          <div class="card-header">
            <h3 class="card-title">
              <i class="fas fa-edit"></i>
              Actions
            </h3>
          </div>
          <div class="card-body">
            <div class="form-group">
              <input type="submit" value="{% trans 'Save' %}" class="default btn btn-outline-success form-control" />
            </div>
            <div class="form-group">
              <input type="submit" value="{% trans 'Save and continue editing' %}" class="btn btn-outline-info form-control" name="_continue" />
            </div>
            <div class="form-group">
              <p class="deletelink-box">
                <a href="{% url 'filebrowser:fb_delete_confirm' %}{% query_string %}" class="btn btn-outline-danger form-control deletelink">{% trans "Delete" %}</a>
              </p>
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>
{% endblock %}
