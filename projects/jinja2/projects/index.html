{% extends "layout.html" %}

{% block content %}
  <div id="tab-content" class='container is-fluid'>
    <div data-content="my-projects" {% if request.GET.n == 'mp' %}class='is-active'{% endif %}>
      {% if user_projects %}
        <div class="my-projects tile is-ancestor is-parent">
          {% for project in user_projects %}
            <div data-link="{{ url('projects:detail', kwargs={'pk': project.id}) }}" class="project is-child notification has-even-padding is-info tile box is-3">
              <div class="content">
                <p class="title">{{project.title}}</p>
                <div class="content has-text-justified">{{project.guideline|truncate}}</div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% endif %}
    </div>
    <div data-content="shared-projects" {% if request.GET.n == 'sp' %}class='is-active'{% endif %}>
      {% if shared_projects %}
        <div class="shared-projects">
          {% for project in shared_projects %}
            <li>{{ project.title }}</li>
          {% endfor %}
        </div>
      {% endif %}
    </div>
    <div data-content="open-projects" {% if request.GET.n == 'o' %}class='is-active'{% endif %}>
      {% set any_open=False %}
      {% if open_projects %}
        <div class="open-projects">
          {% for project in open_projects %}
            {% if project not in participations %}
              {% set any_open=True %}
              <div class="is-child notification has-even-padding is-link tile is-3">
                <div class="content">
                  <p class="title">{{project.title}}</p>
                  <div class="content has-text-justified">{{project.guideline|truncate}}</div>
                  <form method="POST" action="{{ url('projects:join', kwargs={'proj': project.id}) }}">
                    <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
                    <input class="button is-fullwidth is-link is-inverted is-outlined" type="submit" value="Join"/>
                  </form>
                </div>
              </div>
            {% endif %}
          {% endfor %}
          {% if not any_open %}
            <article class="message is-info">
              <div class="message-body">
                <p>Currently there no more active Open Challenges!</p>
                <!-- <p>Click <a class='intro-button'>here</a> if you want an introduction to the website</p> -->
              </div>
            </article>
          {% endif %}
        </div>
      {% else %}
        <article class="message is-info">
          <div class="message-body">
            <p>Currently there no more active Open Challenges!</p>
            <!-- <p>Click <a class='intro-button'>here</a> if you want an introduction to the website</p> -->
          </div>
        </article>
      {% endif %}
    </div>
    <div data-content="participations" {% if request.GET.n == 'p' or 'n' not in request.GET %}class='is-active'{% endif %}>
      {% if participations %}
        <div class="participations tile is-ancestor is-parent">
          {% for project in participations %}
            <div data-link="{{ url('projects:detail', kwargs={'pk': project.id}) }}" class="is-child notification has-even-padding is-link tile is-3">
              <div class="content">
                <p class="title">{{project.title}}</p>
                <div class="content has-text-justified">{{project.guideline|truncate}}</div>
              </div>
              <footer class="tile-footer">
                {% set user_profile=project.get_profile_for(user) %}
                <div class="tile-footer-item">
                  <span class="icon">
                    <i class="fas fa-star"></i>
                  </span>
                  Level {{user_profile.level().number}}
                </div>
                <div class="tile-footer-item">
                  <span class="icon">
                    <i class="fas fa-trophy"></i>
                  </span>
                  {{user_profile.points}}p
                </div>
              </footer>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <article class="message is-info">
          <div class="message-body">
            <p>Hello, {{user.first_name or user.username}}! Thank you for joining Textinator! You don't have any challenges yet, but you can join to one of the open challenges in the respective tab</p>
            <!-- <p>Click <a class='intro-button'>here</a> if you want an introduction to the website</p> -->
          </div>
        </article>
      {% endif %}
    </div>
  </div>
{% endblock %}