{% load common_extras %}

<style>
  textarea {
    resize: none;
  }

  .article .message-body {
    height: 475px;
    overflow-y: scroll;
    text-align: justify;
  }

  .achievements {
    height: 100%;
  }

  .achievements .message-body {
    height: 100%;
    max-height: 830px;
    overflow-y: scroll;
  }

  .markers {
    height: 100px;
  }

  .marker.tag:hover {
    cursor: pointer;
  }

  .tt-level {
    text-align: center;
  }

  .tt-level .tt-header {
    font-weight: bold;
    font-size: 3em;
  }

  .tt-level .tt-title {
    font-size: 2em;
  }
</style>

<div class="columns">
  <div class="column is-three-quarters">
    <article class="article message is-dark">
      <div class="message-header">
        <p>Article</p>
      </div>
      <div class="selector element message-body">{{text|safe}}</div>
    </article>
    <article class="markers message is-dark">
      <div class="message-header">
        <p>Markers</p>
      </div>
      <div class="message-body">
        {% for marker in task_markers %}
          <span class="marker tag is-{{marker.color}}">{{marker.label_name}}</span>
        {% endfor %}
        {% for marker in project.marker_set.all %}
          <span class="marker tag is-{{marker.color}}">{{marker.label_name}}</span>
        {% endfor %}
      </div>
    </article>
    <article class="question message is-primary">
      <div class="message-header">
        <p>Your question</p>
      </div>
      <div class="message-body">
        <form id="inputForm" action="{% url 'projects:record_datapoint' %}">
          {% csrf_token %}
          <input type="hidden" name="pid" value="{{project.pk}}">
          <div class="field">
            <div class="control">
              <input class='question input' type="text" name="question" placeholder="Type in your question here">
            </div>
          </div>
          <div class="field is-grouped">
            <div class="control">
              <button class='submit button'>Submit</button>
            </div>
            <div class='control'>
              <a href="{% url 'projects:new_article' proj=project.pk %}" class="button" id="getNewArticle">Get new article</a>
            </div>
          </div>
        </form>
      </div>
    </article>
  </div>
  <div class="column">
    <article class="achievements message is-info">
      <div class="message-header">
        <p>Achievements</p>
      </div>
      <div class="message-body">
        <div id="leaderboard" class="content">
          {{leaderboard_template|safe}}          
        </div>

        {% if next_level_points %}
          <div class="content">
            <div class="has-text-centered no-margin title is-4">Until next level</div>
            <div class="tt-set-size tt-charts-container">
              <div class="tt-pie-wrapper progress-{{progress}}">
                <span class="tt-label">{{next_level_points|subtract:level.points}}<span class="smaller">p</span></span>
                <div class="tt-pie">
                  <div class="left-side half-circle"></div>
                  <div class="right-side half-circle"></div>
                </div>
              </div>
            </div>
          </div>
        {% endif %}
      </div>
    </article>
  </div>
</div>
